import e,{createElement as t,Children as n,cloneElement as r,Component as i,useContext as a,useRef as o,useState as u,useLayoutEffect as s}from"react";import $ from"create-react-context";import l from"warning";import c from"hoist-non-react-statics";import f from"prop-types";import d from"react-fast-compare";function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){p(e,t,n[t])})}return e}function v(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==u.return||u.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t,n){return t&&y(e.prototype,t),n&&y(e,n),e}function V(e){return(V="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e){return(w="function"===typeof Symbol&&"symbol"===V(Symbol.iterator)?function(e){return V(e)}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":V(e)})(e)}function F(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function C(e,t){return!t||"object"!==w(t)&&"function"!==typeof t?F(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}var O=$({}),E=Object.getPrototypeOf({}),j=/\s*(?:\]\s*\.|\]\s*\[|\.|\[|\])\s*/g,x=D(window)?global:window;function D(e){return"undefined"===typeof e}function N(e){return"function"===typeof e}function _(e){return D(e)||null===e||e+""===""}function A(e){return!!e&&N(e.then)}function T(e){return!!function(e){return"[object Object]"===Object.prototype.toString.call(e)}(e)&&(null===Object.getPrototypeOf(e)||!!N(e.constructor)&&e.constructor.prototype===E)}function R(e){if(e&&"object"===typeof e){if(Array.isArray(e)){for(var t=[],n=0,r=e.length;n<r;n++)t[n]=R(e[n]);return t}if(T(e)){var i={};for(var a in e)i[a]=R(e[a]);return i}}return e}var U=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return N(e)&&e.apply(void 0,n),n[0]};function I(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return N(n[0])?e.apply(void 0,n):function(t){return e(t,n[0])}}}var H=["minlength","maxlength","max","min","required","pattern","step"];var M,L,B=function(e){try{return new Function("origin","global","return typeof ".concat(e," === 'number' || (typeof ").concat(e," !== 'undefined' && !(origin in global)) ? ").concat(e," : origin"))(e,x)}catch(t){return e}},Y=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],i=t[1],a=t[2];l("string"===typeof i,"The second parameter(".concat(JSON.stringify(i),") of parsePath() must be a string."));var o=(i.match(j)||[]).map(function(e){return e.replace(/\s/g,"")}),u=i.split(j).map(function(e){return e.trim()}).filter(function(e){return""!==e}),s=r;try{if(t.length<3)for(var $=0,c=u.length;$<c;$++){var f=B(u[$]);if($+1===c)return s[f];if(D(s[f]))break;s=s[f]}else for(var d=0,p=u.length;d<p;d++){var h=B(u[d]),v=u[d+1],m=o[d];if(D(v)){s[h]=a;break}switch(m){case"].":case".":s=D(s[h])?s[h]={}:s[h];break;case"][":case"[":var g=B(v);s=D(s[h])?s[h]="number"===typeof g&&g>=0?[]:{}:s[h];break;default:s[h]=a}}}catch(e){l(!1,"The name '%s' of Field seems is not a legal expression.",i)}if(t.length>2)return r},Q=function(e,t){for(var n=0,r=e.length;n<r;n++)if(!0===t(e[n]))return e[n]},G=function(e,t){return Object.keys(e).reduce(function(n,r){return n[r]=t(e[r],r,e),n},{})},z=function(e,t){return Object.keys(e).forEach(function(n){return t(e[n],n,e)})},q=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.reduce(function(){return t.apply(void 0,arguments),arguments.length<=0?void 0:arguments[0]},n)},K=function(e,t){D(Y(e,t))||(Y(e,t,void 0),function e(t,n,r){z(t,function(n,r){void 0===n?delete t[r]:n&&"object"===typeof n&&e(n,r,t)}),r&&Object.keys(t).every(function(e){return void 0===t[e]})&&(r[n]=void 0,e(r))}(e))},J="FORM_VALIDATE_RESULT";"function"===typeof requestAnimationFrame?(M=requestAnimationFrame,L=cancelAnimationFrame):(M=setTimeout,L=clearTimeout);var W=function(a){function o(e){var t;return g(this,o),(t=C(this,P(o).call(this,e))).$$registers={},t.$$deepRegisters={},t.$$regDuplications={},t.$$checkDuplication=function(){var e,n=F(t).$$regDuplications;z(n,function(t,r){var i=m(t,2),a=i[0],o=i[1];l(a.$$reserved,"The Field with a name '".concat(r,"' has been registered!")),o.$$reset(a.$getState()),e=delete n[r]}),e&&t.$render()},t.$$register=function(e,n,r){if(t.$$unregister(r,n),e){var i=t.$$getRegister(e);i?(L(t.$$duplicateTimer),t.$$regDuplications[e]=[i,n],t.$$duplicateTimer=M(t.$$checkDuplication)):(t.$$fieldChangedQueue.push({name:e,$newValue:n.$getState().$value}),K(t.$$defaultValues,e)),t.$$registers[n.$name=e]=n,t.createDeepRegisters(),t.$render()}},t.$$unregister=function(e,n,r){if(e){if(e in t.$$regDuplications){var i=m(t.$$regDuplications[e],2),a=i[0],o=i[1];t.$$fieldChangedQueue.push({name:e,$newValue:o.$getState().$value,$prevValue:a.$getState().$value}),delete t.$$regDuplications[e]}else t.$$registers[e]===n&&(r?n.$$reserved=!0:(delete t.$$registers[e],t.$$fieldChangedQueue.push({name:e,$prevValue:n.$getState().$value}),K(t.$$defaultValues,e)));t.createDeepRegisters(),t.$render()}},t.$$defaultInitialize=function(){var e=t.props,n=e.$defaultValues,r=e.$defaultStates;t.$$defaultValues=t.$$deepParseObject(R(N(n)?n(t.props)||{}:n)),t.$$defaultStates=t.$$deepParseObject(R(N(r)?r(t.props)||{}:r))},t.$$getDefault=function(){return{$$defaultStates:t.$$defaultStates,$$defaultValues:t.$$defaultValues}},t.$$fieldChangedQueue=[],t.$$triggerFormChange=function(){if(t.$$fieldChangedQueue.length){var e=v(t.$$fieldChangedQueue);t.$$fieldChangedQueue.length=0;var n={},r={},i=t.$$registers,a=!1;e.forEach(function(e){if(e.name in i||delete e.$newValue,e.$newValue!==e.$prevValue){if("$newValue"in e&&"$prevValue"in e){var o=t.$$getRegister(e.name);o&&o.$$triggerChange(e)}"$newValue"in e&&Y(n,e.name,e.$newValue),"$prevValue"in e&&Y(r,e.name,e.$prevValue),a=!0}}),a&&(N(t.props.$validator)&&t.$$formValidate(),N(t.props.$onFormChange)&&t.props.$onFormChange(t.$formutil,n,r))}},t.createDeepRegisters=function(){return t.$$deepRegisters=t.$$deepParseObject(t.$$registers)},t.$$getRegister=function(e){if(e){var n=t.$$registers[e]||Y(t.$$deepRegisters,e);if(n)return n}},t.$$formValidate=function(e){return t.$$formValidatePromise=new Promise(function(n){var r,i,a,o,u=(0,t.props.$validator)(t.$formutil.$params,t.formtutil),s=function(t){return n(U(e,U(a,t)))};A(u)?(t.$$formPending||(t.$$formPending=!0,t.$render()),i=function(e){return r=e(s)},o=u.then(function(){},function(e){return e}).then(function(e){return r||(t.$shouldCancelPrevAsyncValidate=null,t.$$formPending=!1,t.$$setFormErrors(e,s))})):(t.$$formPending&&(t.$$formPending=!1),o=t.$$setFormErrors(u,s)),t.$shouldCancelPrevAsyncValidate&&t.$shouldCancelPrevAsyncValidate(function(e){return a=e,o}),t.$shouldCancelPrevAsyncValidate=i})},t.$$setFormErrors=function(e,n){return e&&(e instanceof Error||"object"!==typeof e)?(l(!1,"The result of $validator in <Form /> should always return None(null,undefined) or an object contains error message of Field."),t.$render(n)):t.$$setStates(e||{},function(e,t){var n=t.$getState().$error,r=void 0===n?{}:n;return e?{$error:h({},r,p({},J,e))}:r[J]?(delete r[J],{$error:r}):void 0},n,!0)},t.$getField=function(e){var n=t.$$getRegister(e);if(l(!e||n,"$getField('".concat(e,"') fail to find the matched Field. Maybe it has been unmounted.")),l(e,"You should pass a name of the mounted Field to $getField()."),n)return n.$new()},t.$$onChange=function(e,n,r){return t.$setStates(p({},e,n),r)},t.$$setStates=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,a=t.$$deepParseObject(e),o=!1;return z(t.$$registers,function(r,u){var s=u in e?e[u]:Y(a,u);if(!D(s)||i){var $=n(s,r);if($){var l=t.$formutil.$weakParams[u],c=r.$$merge($).$value;if(r.$$detectChange($),"$value"in $||"$viewValue"in $){var f=Q(t.$$fieldChangedQueue,function(e){return e.name===u});f?("$prevValue"in f||(f.$prevValue=f.$newValue),f.$newValue=c):t.$$fieldChangedQueue.push({name:u,$newValue:c,$prevValue:l})}o=!0}}}),o?t.$render(r):Promise.resolve(U(r,t.$formutil))},t.$render=function(e){return new Promise(function(n){return t.forceUpdate(function(){return n(U(e,t.$formutil))})})},t.$validates=function(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];if(N(r[r.length-1])&&(e=r.pop()),r.length){!function e(n){n.forEach(function(n){if(Array.isArray(n))e(n);else{var r=t.$getField(n);r&&r.$validate()}})}(r)}else z(t.$$registers,function(e){return e.$validate()}),N(t.props.$validator)&&t.$$formValidate();return t.$onValidates(e)},t.$onValidates=function(e){var n=Object.keys(t.$$registers).map(function(e){return t.$$registers[e].$onValidate()});return n.push(t.$$formValidatePromise),Promise.all(n).then(function(){return U(e,t.$formutil)})},t.$validate=function(e,n){var r=t.$getField(e);return r?r.$validate(n):U(n)},t.$reset=function(e,n){return t.$$defaultInitialize(),N(e)&&(n=e,e={}),t.$$setStates(e,function(e,t){return t.$$reset(e)},n,!0)},t.$setStates=function(e,n){return t.$$setStates(e,function(e){return e},n)},t.$setValues=function(e,n){return t.$$deepParseObject(R(e),t.$$defaultValues),t.$$setStates(e,function(e){return{$value:e}},n)},t.$setFocuses=function(e,n){return t.$$setStates(e,function(e){return{$focused:e}},n)},t.$setDirts=function(e,n){return t.$$setStates(e,function(e){return{$dirty:e}},n)},t.$setTouches=function(e,n){return t.$$setStates(e,function(e){return{$touched:e}},n)},t.$setPendings=function(e,n){return t.$$setStates(e,function(e){return{$pending:e}},n)},t.$setErrors=function(e,n){return t.$$setStates(e,function(e){return{$error:e}},n)},t.$batchState=function(e,n){return t.$setStates(G(t.$$registers,function(){return e}),n)},t.$batchDirty=function(e,n){return t.$batchState({$dirty:e},n)},t.$batchTouched=function(e,n){return t.$batchState({$touched:e},n)},t.$batchFocused=function(e,n){return t.$batchState({$focused:e},n)},t.$batchPending=function(e,n){return t.$batchState({$pending:e},n)},t.$batchError=function(e,n){return t.$batchState({$error:e},n)},t.$$defaultInitialize(),t}return k(o,i),b(o,[{key:"getFormContext",value:function(){return{$$registers:this.$$registers,$$register:this.$$register,$$unregister:this.$$unregister,$$onChange:this.$$onChange,$$getDefault:this.$$getDefault,$formutil:this.$formutil}}},{key:"$$deepParseObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return z(e,function(e,n){return Y(t,n,e)}),t}},{key:"componentDidUpdate",value:function(){var e=this;L(this.$$triggerChangeTimer),this.$$triggerChangeTimer=M(function(){e.$$triggerFormChange()})}},{key:"_render",value:function(){var e=this.$formutil,i=this.props,a=i.children,o=i.render,u=i.component;return u?t(u,{$formutil:e}):N(o)?o(e):N(a)?a(e):n.map(a,function(t){return t&&N(t.type)?r(t,{$formutil:e}):t})}},{key:"render",value:function(){var t=this,n=this.props.$processer,r=Object.keys(this.$$registers).map(function(e){return{path:e,$state:t.$$registers[e].$getState()}}),i=q(r,function(e,t){var r=t.path,i=t.$state;n&&n(i,r),"$value"in i&&(i.$dirty||!D(i.$value))&&(e[r]=i.$value)}),a=q(r,function(e,t){var n=t.path;t.$state;return n in i&&Y(e,n,i[n])}),o=r.some(function(e){return e.$state.$invalid}),u=r.some(function(e){return e.$state.$dirty}),s=r.some(function(e){return e.$state.$touched}),$=r.some(function(e){return e.$state.$focused}),l=this.$$formPending||r.some(function(e){return e.$state.$pending}),c=this.$formutil={$$registers:h({},this.$$registers),$$deepRegisters:this.$$deepRegisters,$states:q(r,function(e,t){var n=t.path,r=t.$state;return Y(e,n,r)}),$params:h({},this.$$defaultValues,a),$errors:q(r,function(e,t){var n=t.path,r=t.$state;r.$invalid&&Y(e,n,r.$error)}),$dirts:q(r,function(e,t){var n=t.path,r=t.$state;return Y(e,n,r.$dirty)}),$touches:q(r,function(e,t){var n=t.path,r=t.$state;return Y(e,n,r.$touched)}),$focuses:q(r,function(e,t){var n=t.path,r=t.$state;return Y(e,n,r.$focused)}),$pendings:q(r,function(e,t){var n=t.path,r=t.$state;return Y(e,n,r.$pending)}),$weakStates:q(r,function(e,t){var n=t.path,r=t.$state;return e[n]=r}),$weakParams:i,$weakErrors:q(r,function(e,t){var n=t.path,r=t.$state;r.$invalid&&(e[n]=r.$error)}),$weakDirts:q(r,function(e,t){var n=t.path,r=t.$state;return e[n]=r.$dirty}),$weakTouches:q(r,function(e,t){var n=t.path,r=t.$state;return e[n]=r.$touched}),$weakFocuses:q(r,function(e,t){var n=t.path,r=t.$state;return e[n]=r.$focused}),$weakPendings:q(r,function(e,t){var n=t.path,r=t.$state;return e[n]=r.$pending}),$getFirstError:function(e){if(e){var t=c.$getField(e);return t&&t.$getFirstError()}for(var n in c.$weakErrors){var r=c.$weakErrors[n];for(var i in r)return r[i]instanceof Error?r[i].message:r[i]}},$render:this.$render,$getField:this.$getField,$onValidates:this.$onValidates,$new:function(){return t.$formutil},$setStates:this.$setStates,$setValues:this.$setValues,$setErrors:this.$setErrors,$setTouches:this.$setTouches,$setDirts:this.$setDirts,$setFocuses:this.$setFocuses,$batchState:this.$batchState,$batchTouched:this.$batchTouched,$batchDirty:this.$batchDirty,$batchFocused:this.$batchFocused,$reset:this.$reset,$validates:this.$validates,$validate:this.$validate,$valid:!o,$invalid:o,$dirty:u,$pristine:!u,$touched:s,$untouched:!s,$focused:$,$pending:l};return e.createElement(O.Provider,{value:this.getFormContext()},this._render())}}]),o}();function X(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function Z(){return(Z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}W.displayName="React.Formutil.Form",W.defaultProps={$defaultValues:{},$defaultStates:{}};var ee=I(function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=function(r){function a(){return g(this,a),C(this,P(a).apply(this,arguments))}return k(a,i),b(a,[{key:"render",value:function(){var r=Z({},this.props),i=this.props,a=(i.component,X(i,["component"]));return["$defaultStates","$defaultValues","$onFormChange","$validator","$processer"].forEach(function(e){e in r&&("$defaultStates"!==e&&"$defaultValues"!==e||(a[e]=h({},n[e],r[e])),delete r[e])}),e.createElement(W,Object.assign({},n,a,{render:function(n){return e.createElement(t,Object.assign({},r,{$formutil:n}))}}))}}]),a}();return r.displayName="React.Formutil.withForm."+(t.displayName||t.name||"Anonymous"),c(r,t)}),te=0,ne={$valid:!0,$invalid:!1,$dirty:!1,$pristine:!0,$touched:!1,$untouched:!0,$focused:!1,$pending:!1,$error:{}};function re(e){return!0!==e}function ie(e,t,n){l(!D(e),"You should return a string or Error when the validation('".concat(n&&n+": ").concat(t,"') failed, otherwise return true."))}f.string,f.any,f.oneOfType([f.object,f.func]),f.func,f.object,f.object,f.bool,f.bool,f.func,f.func,f.func,f.func;function ae(){return te++}function oe(e,t){var n;function r(t){var n,r=e.props,i=e.$formContext;if(i.$$getDefault){var a=r.name,o=i.$$getDefault(),u=o.$$defaultStates,s=o.$$defaultValues;if(a&&s){var l=Y(s,a);n=Y(u,a)||{},D(l)||(n.$value=l)}}var c=r.$defaultValue,f=r.$defaultState;return $(h({},ne,N(f)?f(r):f,{$value:N(c)?c(r):"$defaultValue"in r?c:""},n,t))}function i(){return h({},e.$state)}function a(t){return n=new Promise(function(n){var r,i,a,$,l=e.props,c=e.$formContext,f=h({},l.$validators,l.$asyncValidators),d=e.$state,p=d.$value,v=d.$pending,m=Z({},d.$error),g=c.$formutil,y={},b=!1;delete m[J];var V=Object.keys(f).reduce(function(t,n){if(delete m[n],!b&&null!=l[n]){var i=f[n](p,l[n],h({},l,{$formutil:g,$fieldutil:e.$fieldutil,$validError:y}));A(i)?t.push(i.catch(function(e){r||u(n,e||n)})):re(i)&&(y[n]=i||n,ie(i,n,l.name),l.$validateLazy&&(b=!0))}return t},[]),w=function(e){return n(U(t,U(a,e)))};V.length?(v||s(!0),i=function(e){return r=e(w)},V.push(o(h({},m,y))),$=Promise.all(V).then(function(){return r||(e.$shouldCancelPrevAsyncValidate=null,s(!1,w))})):(v&&s(!1),$=o(h({},m,y),w)),e.$shouldCancelPrevAsyncValidate&&e.$shouldCancelPrevAsyncValidate(function(e){return a=e,$}),e.$shouldCancelPrevAsyncValidate=i})}function o(t,n){return e.$setState({$error:t},n)}function u(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,i=Z({},e.$state.$error);return re(n)?(i[t]=n||t,ie(n,t,e.props.name)):delete i[t],o(i,r)}function s(t,n){return e.$setState({$pending:t},n)}function $(t){var n=Z({},t);"$error"in n&&(n.$error||(n.$error={}),n.$valid=0===Object.keys(n.$error).length);var r=e.props,a=r.$parser,o=r.$formatter;if("$viewValue"in n&&!("$value"in n)){n.$value=a?a(n.$viewValue,function(e){return n.$viewValue=e}):n.$viewValue}else if("$value"in n&&!("$viewValue"in n)){n.$viewValue=o?o(n.$value,function(e){return n.$value=e}):n.$value}return"$valid"in n?n.$invalid=!n.$valid:"$invalid"in n&&(n.$dirty=!n.$invalid),"$dirty"in n?n.$pristine=!n.$dirty:"$pristine"in n&&(n.$dirty=!n.$pristine),"$touched"in n?n.$untouched=!n.$touched:"$untouched"in n&&(n.$touched=!n.$untouched),e.$state=h({},e.$state,n),i()}return{$$FIELD_UUID:e.$$FIELD_UUID,$$reset:r,$$merge:$,$$detectChange:function(e){("$value"in e||"$viewValue"in e)&&a()},$$triggerChange:function(t){var n=t.$newValue,r=t.$prevValue,i=e.props.$onFieldChange;N(i)&&i(n,r,e.$formContext.$formutil)},$onValidate:function(e){return n.then(e),n},$new:function(){return e.$fieldutil},$picker:i,$getState:i,$getComponent:function(){return t},$reset:function(t,n){return e.$setState(r(t),n)},$getFirstError:function(){var t=e.$state.$error,n=void 0===t?{}:t;for(var r in n)return n[r]instanceof Error?n[r].message:n[r]},$validate:a,$setState:e.$setState,$render:function(t,n){return e.$setState({$viewValue:t,$dirty:!0},n)},$setValue:function(t,n){return e.$setState({$value:t},n)},$setTouched:function(t,n){return e.$setState({$touched:t},n)},$setDirty:function(t,n){return e.$setState({$dirty:t},n)},$setFocused:function(t,n){return e.$setState({$focused:t},n)},$setValidity:u,$setError:o,$setPending:s}}var ue=function(a){function o(){var e,t;g(this,o);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=C(this,(e=P(o)).call.apply(e,[this].concat(r)))).$$FIELD_UUID=ae(),t.$setState=function(e,n){return new Promise(function(r){var i=function(){return r(U(n,t.$fieldutil))};if(t.isMounting){var a=t.props.name;a in(t.$formContext.$$registers||{})?t.$formContext.$$onChange(a,e,i):(t.$registered.$$merge(e),t.$registered.$$detectChange(e),t.forceUpdate(i))}else t.$registered.$$merge(e),i()})},t}return k(o,i),b(o,[{key:"componentDidMount",value:function(){this.isMounting=!0;var e=this.props.name,t=this.$formContext;l(!e||t.$formutil,"You should enusre that the <Field /> with the name '".concat(e,"' must be used underneath a <Form /> component or withForm() HOC, otherwise it's isolated.")),l(e,"You should assign a name to <Field />, otherwise it will be isolated!"),t.$$register&&t.$$register(e,this.$fieldHandler),this.$prevValue=this.$state.$value}},{key:"componentWillUnmount",value:function(){this.$formContext.$$unregister&&this.$formContext.$$unregister(this.props.name,this.$fieldHandler,this.props.$reserveOnUnmount),this.isMounting=!1}},{key:"componentDidUpdate",value:function(e){var t=this.props.name;t!==e.name&&this.$formContext.$$register&&this.$formContext.$$register(t,this.$fieldHandler,e.name),this.$state.$value!==this.$prevValue&&(t in(this.$formContext.$$registers||{})||this.$registered.$$triggerChange({$newValue:this.$state.$value,$prevValue:this.$prevValue}),this.$prevValue=this.$state.$value)}},{key:"_render",value:function(){return function(e,i){var a=i.children,o=i.render,u=i.component;return u?t(u,{$fieldutil:e}):N(o)?o(e):N(a)?a(e):n.map(a,function(t){return t&&N(t.type)?r(t,{$fieldutil:e}):t})}(this.$fieldutil=h({$name:this.props.name},this.$registered.$getState(),this.$registered,{$$formutil:this.$formContext.$formutil}),this.props)}},{key:"render",value:function(){var t=this,n=!this.$formContext;return e.createElement(O.Consumer,null,function(e){return t.$formContext=e,t.$fieldHandler||(t.$fieldHandler=oe(t,t)),t.$registered=(e.$$registers||{})[t.$fieldHandler.$name]||t.$fieldHandler,n&&(t.$fieldHandler.$$reset(),t.$fieldHandler.$validate()),t._render()})}}]),o}();ue.displayName="React.Formutil.Field";var se=I(function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=function(r){function a(){return g(this,a),C(this,P(a).apply(this,arguments))}return k(a,i),b(a,[{key:"render",value:function(){var r=Z({},this.props),i=this.props,a=(i.component,X(i,["component"]));return["$validators","$asyncValidators","$validateLazy","$reserveOnUnmount","$defaultValue","$defaultState","$onFieldChange","$parser","$formatter","name"].concat(Object.keys(h({},n.$validators,n.$asyncValidators,r.$validators,r.$asyncValidators))).forEach(function(e){e in r&&("$validators"!==e&&"$asyncValidators"!==e&&"$defaultState"!==e||(a[e]=h({},n[e],r[e])),delete r[e])}),e.createElement(ue,Object.assign({},n,a,{render:function(n){return e.createElement(t,Object.assign({},r,{$fieldutil:n}))}}))}}]),a}();return r.displayName="React.Formutil.withField."+(t.displayName||t.name||"Anonymous"),c(r,t)}),$e=function(t){function n(){return g(this,n),C(this,P(n).apply(this,arguments))}return k(n,i),b(n,[{key:"render",value:function(){var t=this,n=this.props,r=(n.$fieldutil,n.value),i=n.onChange,a=n.onFocus,o=n.onBlur,u=n.checked,s=n.unchecked,$=X(n,["$fieldutil","value","onChange","onFocus","onBlur","checked","unchecked"]),l=this.props.type,c={value:"compositionValue"in this?this.compositionValue:r,onCompositionEnd:function(e){t.composition=!1,delete t.compositionValue,c.onChange(e)},onCompositionStart:function(){return t.composition=!0},onChange:function(e){var n=e.target.value;t.composition?(t.compositionValue=n,t.forceUpdate()):i(n,e)},onFocus:a,onBlur:o},f="input";switch(l){case"select":f=l,c.onChange=function(e){var t=e.target,n=t.multiple?[].slice.call(t.options).filter(function(e){return e.selected}).map(function(e){return e.value}):t.value;i(n,e)},delete $.type;break;case"textarea":f=l,delete $.type;break;case"checkbox":case"radio":c={checked:r===u,onChange:function(e){i(e.target.checked?u:s,e)},onFocus:a,onBlur:o}}return e.createElement(f,Object.assign({},$,c))}}]),n}();$e.displayName="React.Formutil.EasyField.Native",$e.defaultProps={value:"",type:"text",checked:!0,unchecked:!1};var le=$({}),ce=le.Provider,fe=le.Consumer,de=function(t){function a(){return g(this,a),C(this,P(a).apply(this,arguments))}return k(a,i),b(a,[{key:"getGroupContext",value:function(){return this.props}},{key:"_render",value:function(){var t=this.props,i=t.className,a=t.groupNode,o=t.children,u={GroupOption:pe,Field:he},s=N(o)?o(u):n.map(o,function(e){return r(e,u)});return null===a?s:e.createElement(a,{className:i},s)}},{key:"render",value:function(){return e.createElement(ce,{value:this.getGroupContext()},this._render())}}]),a}();de.displayName="React.Formutil.EasyField.Group",de.defaultProps={type:"checkbox",groupNode:"div"};var pe=function(t){function n(){return g(this,n),C(this,P(n).apply(this,arguments))}return k(n,i),b(n,[{key:"componentDidMount",value:function(){l("$value"in this.props,"You should pass a $value to <GroupOption />.")}},{key:"render",value:function(){var t=this.props,n=t.$value,r=t.onChange,i=t.onFocus,a=t.onBlur,o=X(t,["$value","onChange","onFocus","onBlur"]);return e.createElement(fe,null,function(t){var u=t.type,s=t.name,$="radio"===u?{checked:t.value===n,onChange:function(e){t.onChange(n,e),r&&r(e)}}:"checkbox"===u?{checked:t.value.indexOf(n)>-1,onChange:function(e){t.onChange(e.target.checked?t.value.concat(n):t.value.filter(function(e){return e!==n}),e),r&&r(e)}}:{value:t.value,onChange:function(e){t.onChange(e),r&&r(e)}};return e.createElement("input",Object.assign({name:s},o,$,{type:u,onFocus:function(e){t.onFocus(e),i&&i(e)},onBlur:function(e){t.onBlur(e),a&&a(e)}}))})}}]),n}();pe.displayName="React.Formutil.EasyField.Group.Option";var he=function(t){function n(){return g(this,n),C(this,P(n).apply(this,arguments))}return k(n,i),b(n,[{key:"componentDidMount",value:function(){l(!1,'The "Field" property in EasyField\'s children-props has been deprecated. Please use "GroupOption" instead.')}},{key:"render",value:function(){return e.createElement(pe,this.props)}}]),n}();he.displayName="React.Formutil.EasyField.Group.Option.Deprecated";var ve=function(t){function n(e){var t;return g(this,n),(t=C(this,P(n).call(this,e))).id=0,t.latestValue=t.props.value,t.FieldValidators={required:function(e){return null!==e}},t.$onFormChange=function(e){e.$onValidates(function(e){var n=e.$invalid,r=e.$params;n?t.props.value.length&&t.props.onChange(t.latestValue=[]):d(t.props.value,r.list)||t.props.onChange(t.latestValue=r.list)})},t.swap=function(e,n,r){return t.$setState(function(t){var r=t.items,i=[r[e],r[n]];return r[n]=i[0],r[e]=i[1],r},r)},t.insert=function(){for(var e,n,r,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return a.forEach(function(t){N(t)?r=t:"number"===typeof t?e=t:"object"===typeof t&&(n=t)}),t.$setState(function(r){var i=r.items;return D(e)?i.push(t.getId(n)):i.splice(e,0,t.getId(n)),{items:i}},r)},t.remove=function(){for(var e,n,r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return i.forEach(function(t){N(t)?n=t:"number"===typeof t&&(e=t)}),t.$setState(function(n){var r=n.items;return D(e)?r.pop():r.splice(e,1),r.length||(r=[t.getId()]),{items:r}},n)},t.$setState=function(e,n){return new Promise(function(r){return t.setState(e,function(){return t.$formutil.$onValidates(function(e){return r(U(n,e))})})})},t.state={items:e.value.length?e.value.map(function(){return t.getId()}):[t.getId()],formKey:0},t}return k(n,i),b(n,[{key:"componentDidUpdate",value:function(e){var t=this;this.props.value!==this.latestValue&&(this.setState({items:this.props.value.length?this.props.value.map(function(){return t.getId()}):[this.getId()],formKey:this.state.formKey+1}),this.latestValue=this.props.value)}},{key:"getId",value:function(e){return{id:this.id++,values:e}}},{key:"render",value:function(){var t=this,n=this.props,r=n.children,i=n.onFocus,a=n.onBlur,o=n.value;if(!N(r))return null;var u={$length:this.state.items.length,$insert:this.insert,$remove:this.remove,$swap:this.swap,$push:function(e,n){return t.insert(e,n)},$pop:function(e){return t.remove(e)},$shift:function(e){return t.remove(0,e)},$unshift:function(e,n){return t.insert(0,e,n)},onFocus:i,onBlur:a};return e.createElement(W,{key:this.state.formKey,$defaultValues:{list:o},$onFormChange:this.$onFormChange,children:function(n){return t.$formutil=n,t.state.items.map(function(i,a){var o=i.id,s=i.values;return e.createElement(ue,{key:o,required:!0,$defaultValue:s||null,$validators:t.FieldValidators,name:"list[".concat(a,"]"),children:function(i){return e.createElement(W,{$defaultValues:i.$value||{},$onFormChange:function(e){return e.$onValidates(function(e){var t=e.$invalid,n=e.$params;t?null!==i.$viewValue&&i.$render(null):d(i.$viewValue,n)||i.$render(n)})},children:function(e){return r(h({},u,e,{$index:a,$isLast:function(){return a===t.state.items.length-1},$isFirst:function(){return 0===a}}),n)}})}})})}})}}]),n}();ve.displayName="React.Formutil.EasyField.List";var me="__TYPE__",ge=[["required",function(e,t,n){var r=n.__TYPE__,i=n.checked;return"checked"===r?e===(void 0===i||i):!_(e)}],["maxLength",function(e,t){return _(e)||e.length<=t}],["minLength",function(e,t){return _(e)||e.length>=t}],["max",function(e,t){return _(e)||1*e<=t}],["min",function(e,t){return _(e)||1*e>=t}],["pattern",function(e,t){return _(e)||t.test(e)}],["enum",function(e,t){return _(e)||t.indexOf(e)>-1}],["checker",function(e,t,n){return t(e,n)}]].reduce(function(e,t){var n=m(t,2),r=n[0],i=n[1];return e[r]=function(e,t,n){var a=n.validMessage,o=void 0===a?{}:a;return i.apply(void 0,arguments)||o[r]||"Error input: ".concat(r)},e},{}),ye=(f.string,f.oneOfType([f.func,f.node]),f.func,f.func,f.any,f.object,f.string,f.string,f.string,f.string,f.string,{validMessage:{},valuePropName:"value",changePropName:"onChange",focusPropName:"onFocus",blurPropName:"onBlur",$parser:function(e){return"string"===typeof e?e.trim():e}});function be(e,t,n){var r,i=t.valuePropName,a=t.changePropName,o=t.focusPropName,u=t.blurPropName,s=t.passUtil,$=h({},n,(p(r={},i,e.$viewValue),p(r,a,function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];var u=r[0],s=r[r.length-1];s=s&&s.target?[s]:r;var $=t[a];$&&$.apply(void 0,v(s));var l=function(e){return e&&e.target?e.target[i]:e}(u);e.$render(l)}),p(r,o,function(){var n=t[o];n&&n.apply(void 0,arguments),e.$setFocused(!0)}),p(r,u,function(){var n=t[u];n&&n.apply(void 0,arguments),e.$untouched&&e.$setTouched(!0),e.$setFocused(!1)}),r));return s&&($[!0===s?"$fieldutil":s]=e),$}function Ve(e){var t=e.children,n=e.component,r=e.render,i=X(e,["children","component","render"]),a=i.name,o=i.type,u=i.defaultValue,s=(i.valuePropName,i.changePropName,i.focusPropName,i.blurPropName,i.validMessage,i.__TYPE__,i.passUtil,i.$defaultValue,i.$defaultState,i.$onFieldChange,i.$validators,i.$asyncValidators,i.$validateLazy,i.$reserveOnUnmount,i.$parser,i.$formatter,X(i,["name","type","defaultValue","valuePropName","changePropName","focusPropName","blurPropName","validMessage","__TYPE__","passUtil","$defaultValue","$defaultState","$onFieldChange","$validators","$asyncValidators","$validateLazy","$reserveOnUnmount","$parser","$formatter"])),$={children:t,component:n,render:r},l=!D(o)||D(t)&&D(n)&&D(r);if(Object.keys(h({},i.$validators=h({},ge,i.$validators),i.$asyncValidators)).forEach(function(e){e in s&&(l&&function(e){return H.indexOf(e.toLowerCase())>-1}(e)||delete s[e])}),l){var c=m((o||"").split("."),2),f=c[0],d=void 0===f?"text":f,p=c[1];switch($.component="group"===d?de:"list"===d?ve:$e,a&&(s.name=a),o&&(s.type=d),t&&(s.children=t),d){case"select":case"textarea":e.multiple&&(i[me]="array");break;case"group":"checkbox"===p&&(i[me]="array"),s.type=p;break;case"checkbox":case"radio":i[me]="checked";break;case"list":i[me]="array"}}if(!("$defaultValue"in i)&&"defaultValue"in e&&(i.$defaultValue=u),!("$defaultValue"in i)&&me in i){var v;switch(i[me]){case"checked":var g=i.unchecked;v=void 0!==g&&g;break;case"array":v=[];break;case"object":v={};break;case"number":v=0}i.$defaultValue=v}return{fieldProps:i,childProps:s,renderProps:$}}var we=function(a){function o(){return g(this,o),C(this,P(o).apply(this,arguments))}return k(o,i),b(o,[{key:"render",value:function(){var i=Ve(this.props),a=i.fieldProps,o=i.childProps,u=i.renderProps;return e.createElement(ue,Object.assign({},a,{children:function(e){return function(e,i){var a=i.component,o=i.render,u=i.children;return a?t(a,e):N(o)?o(e):N(u)?u(e):n.map(u,function(t){return r(t,e)})}(be(e,a,o),u)}}))}}]),o}();function Fe(t){var n=function(n){function r(){return g(this,r),C(this,P(r).apply(this,arguments))}return k(r,i),b(r,[{key:"render",value:function(){var n=this;return e.createElement(O.Consumer,null,function(r){return e.createElement(t,Object.assign({},n.props,{$formutil:r.$formutil}))})}}]),r}();return n.displayName="React.Formutil.connect."+(t.displayName||t.name||"Anonymous"),c(n,t)}function Ce(){return a(O)}function Pe(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e&&("string"===typeof e?(t=e,n.name=t):t=(n=e).name);var r=Ce(),i=o({}).current,a=o([]);i.$formContext=r,i.props=n,i.$setState=function(e,n){return new Promise(function(o){var u=function(){return o(U(n,i.$fieldutil))};i.isMounting?t in(r.$$registers||{})?r.$$onChange(t,e,u):($(c.$$merge(e)),c.$$detectChange(e),a.current.push(u)):(c.$$merge(e),u())})};var $=m(u(function(){i.$$FIELD_UUID=ae(),i.$fieldHandler=oe(i);var e=i.$fieldHandler.$$reset();return i.$fieldHandler.$validate(),e}),2)[1],c=(r.$$registers||{})[i.$fieldHandler.$name]||i.$fieldHandler;return s(function(){var e=i.$state;if(i.isMounting&&!(t in(r.$$registers||{}))){var n=i.$prevValue;c.$$triggerChange({$newValue:e.$value,$prevValue:n})}i.$prevValue=e.$value},[i.$state.$value]),s(function(){return i.isMounting=!0,l(!t||r.$formutil,"You should enusre that the useField() with the name '".concat(t,"' must be used underneath a <Form /> component or withForm() HOC, otherwise it's isolated.")),l(t,"You should pass a name argument to useField(), otherwise it will be isolated!"),function(){r.$$unregister&&r.$$unregister(t,i.$fieldHandler,n.$reserveOnUnmount),i.isMounting=!1}},[]),s(function(){r.$$register&&(i.$registered=r.$$register(t,i.$fieldHandler,i.$prevName)),i.$prevName=t},[t]),s(function(){if(a.current.length>0){var e=v(a.current);for(a.current.length=0;e.length;)e.pop()(i.$fieldutil)}}),i.$fieldutil=h({$name:t},c.$getState(),c,{$$formutil:r.$formutil})}function Se(){return Ce().$formutil}function ke(e){var t=Ve(e=h({},ye,e,{children:null})),n=t.fieldProps,r=t.childProps;return be(Pe(n),n,r)}we.displayName="React.Formutil.EasyField",we.defaultProps=ye;export{we as EasyField,ue as Field,W as Form,Fe as connect,Pe as useField,Se as useForm,ke as useHandler,se as withField,ee as withForm};
