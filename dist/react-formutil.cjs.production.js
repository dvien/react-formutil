"use strict";Object.defineProperty(exports,"__esModule",{value:true});function e(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var r=e(require("@babel/runtime/helpers/defineProperty"));var t=e(require("@babel/runtime/helpers/objectSpread2"));var n=e(require("@babel/runtime/helpers/toConsumableArray"));var a=e(require("@babel/runtime/helpers/slicedToArray"));var i=e(require("@babel/runtime/helpers/classCallCheck"));var u=e(require("@babel/runtime/helpers/createClass"));var o=e(require("@babel/runtime/helpers/possibleConstructorReturn"));var s=e(require("@babel/runtime/helpers/getPrototypeOf"));var l=e(require("@babel/runtime/helpers/assertThisInitialized"));var $=e(require("@babel/runtime/helpers/inherits"));var f=require("react");var c=e(f);var d=require("react-is");var v=e(require("warning"));var h=e(require("@babel/runtime/helpers/objectWithoutProperties"));var p=e(require("hoist-non-react-statics"));var m=e(require("react-fast-compare"));var g=f.createContext(function(){return{}});var y=Object.getPrototypeOf({});var F=/\s*(?:\]\s*\.|\]\s*\[|\.|\[|\])\s*/g;var b=C(window)?global:window;function C(e){return typeof e==="undefined"}function w(e){return typeof e==="function"}function V(e){return C(e)||e===null||e+""===""}function k(e){return!!e&&w(e.then)}function P(e){return Object.prototype.toString.call(e)==="[object Object]"}function S(e){if(!P(e))return false;if(null===Object.getPrototypeOf(e))return true;if(!w(e.constructor))return false;return e.constructor.prototype===y}function E(e){return d.isValidElementType(e)&&typeof e!=="string"}function O(e){if(Array.isArray(e)){var r=[];for(var t=0,n=e.length;t<n;t++){r[t]=O(e[t])}return r}else if(S(e)){var a={};for(var i in e){if(e.hasOwnProperty(i))a[i]=O(e[i])}return a}return e}var _=function e(r){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++){n[a-1]=arguments[a]}if(w(r)){r.apply(void 0,n)}return n[0]};function x(e){return function(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++){t[n]=arguments[n]}if(E(t[0])){return e.apply(void 0,t)}return function(r){return e(r,t[0])}}}var j=["minlength","maxlength","max","min","required","pattern","step"];function A(e){return j.indexOf(e.toLowerCase())>-1}var D=function e(r){try{var t=new Function("origin","global","return typeof ".concat(r," === 'number' || (typeof ").concat(r," !== 'undefined' && !(origin in global)) ? ").concat(r," : origin"));return t(r,b)}catch(e){return r}};function R(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++){r[a]=arguments[a]}var i=r[0],u=r[1],o=r[2];v(typeof u==="string","The second parameter(".concat(JSON.stringify(u),") of parsePath() must be a string."));var s=(u.match(F)||[]).map(function(e){return e.replace(/\s/g,"")});var l=u.split(F).map(function(e){return e.trim()}).filter(function(e){return e!==""});var $=i;try{if(r.length<3){for(var f=0,c=l.length;f<c;f++){var d=D(l[f]);if(f+1===c){return $[d]}if(C($[d])){break}$=$[d]}}else{for(var h=0,p=l.length;h<p;h++){var m=D(l[h]);var g=l[h+1];var y=s[h];if(C(g)){$[m]=o;break}switch(y){case"].":case".":$=$[m]=C($[m])?{}:t({},$[m]);break;case"][":case"[":var b=D(g);$=$[m]=C($[m])?typeof b==="number"&&b>=0?[]:{}:Array.isArray($[m])?n($[m]):t({},$[m]);break;default:$[m]=o;break}}}}catch(e){v(false,"The name '%s' of Field seems is not a legal expression.",u)}if(r.length>2){return i}}function N(e,r){var t=r.split(F).map(function(e){return e.trim()}).filter(function(e){return e!==""});for(var n=0,a=t.length;n<a;n++){var i=D(t[n]);if(!(i in e)){break}if(n+1===a){return{data:e[i]}}e=e[i]}}function U(e,r){if(e){if(w(e)){e(r)}else if("current"in e){e.current=r}}}var T=function e(r,t){for(var n=0,a=r.length;n<a;n++){if(t(r[n])===true){return r[n]}}};var q=function e(r,t){return Object.keys(r).reduce(function(e,n){e[n]=t(r[n],n,r);return e},{})};var I=function e(r,t){return Object.keys(r).forEach(function(e){return t(r[e],e,r)})};var H=undefined;function M(e,r,t){I(e,function(r,t){if(r===H){delete e[t]}else if(S(r)||Array.isArray(r)){M(r,t,e)}});if(t&&Object.keys(e).every(function(r){return e[r]===H})){t[r]=H;M(t)}}var L=function e(r,t){if(!C(R(r,t))){R(r,t,H);M(r)}};function B(e,r){if(e===r){return true}var t=Object.keys(e);if(t.length!==Object.keys(r).length){return false}for(var n=0;n<t.length;n++){if(e[t[n]]!==r[t[n]]){return false}}return true}var Y="FORM_VALIDATE_RESULT";var Q,z;if(typeof requestAnimationFrame==="function"){Q=requestAnimationFrame;z=cancelAnimationFrame}else{Q=setTimeout;z=clearTimeout}var G=function(e){$(d,e);function d(e){var u;i(this,d);u=o(this,s(d).call(this,e));u.$$formPending=void 0;u.$$formValidatePromise=void 0;u.$$registers={};u.$$deepRegisters={};u.getFormContext=function(){return{$$registers:u.$$registers,$$register:u.$$register,$$unregister:u.$$unregister,$$onChange:u.$$onChange,$$getDefault:u.$$getDefault,$formutil:u.$formutil}};u.$$regDuplications={};u.$$duplicateTimer=void 0;u.$$checkDuplication=function(){var e=l(u),r=e.$$regDuplications;var t;I(r,function(e,n){var i=a(e,2),u=i[0],o=i[1];v(u.$$reserved,"The Field with a name '".concat(n,"' has been registered!"));o.$$reset(u.$getState());t=delete r[n]});if(t){u.$render()}};u.$$register=function(e,r,t){u.$$unregister(t,r);if(e){var n=u.$$getRegister(e);if(n){z(u.$$duplicateTimer);u.$$regDuplications[e]=[n,r];u.$$duplicateTimer=Q(u.$$checkDuplication)}else{u.$$fieldChangedQueue.push({name:e,$newValue:r.$getState().$value});L(u.$$defaultValues,e)}u.$$registers[r.$name=e]=r;u.$$formShouldUpdateFields[e]=true;u.createDeepRegisters();u.$render()}};u.$$unregister=function(e,r,t){if(e){if(e in u.$$regDuplications){var n=a(u.$$regDuplications[e],2),i=n[0],o=n[1];u.$$fieldChangedQueue.push({name:e,$newValue:o.$getState().$value,$prevValue:i.$getState().$value});delete u.$$regDuplications[e]}else if(u.$$registers[e]===r){if(t){r.$$reserved=true}else{delete u.$$registers[e];u.$$fieldChangedQueue.push({name:e,$prevValue:r.$getState().$value});L(u.$$defaultValues,e)}}u.$$formShouldUpdateAll=true;u.createDeepRegisters();u.$render()}};u.$$defaultInitialize=function(){var e=u.props,r=e.$defaultValues,t=e.$defaultStates;u.$$defaultValues=u.$$deepParseObject(O(w(r)?r(u.props)||{}:r));u.$$defaultStates=u.$$deepParseObject(O(w(t)?t(u.props)||{}:t))};u.$$getDefault=function(){return{$$defaultStates:u.$$defaultStates,$$defaultValues:u.$$defaultValues}};u.$$formShouldUpdateFields={};u.$$formShouldUpdateAll=false;u.$$triggerChangeTimer=void 0;u.$$fieldChangedQueue=[];u.$$triggerFormChange=function(){if(u.$$fieldChangedQueue.length){var e=n(u.$$fieldChangedQueue);u.$$fieldChangedQueue.length=0;var r={};var t={};var a=u.$$registers;var i=false;e.forEach(function(e){if(!(e.name in a)){delete e.$newValue}if(e.$newValue!==e.$prevValue){if("$newValue"in e&&"$prevValue"in e){var n=u.$$getRegister(e.name);if(n){n.$$triggerChange(e)}}"$newValue"in e&&R(r,e.name,e.$newValue);"$prevValue"in e&&R(t,e.name,e.$prevValue);i=true}});if(i){if(w(u.props.$validator)){u.$$formValidate()}if(w(u.props.$onFormChange)){u.props.$onFormChange(u.$formutil,r,t)}}}};u.createDeepRegisters=function(){return u.$$deepRegisters=u.$$deepParseObject(u.$$registers)};u.$$getRegister=function(e){if(e){var r=u.$$registers[e]||R(u.$$deepRegisters,e);if(r){return r}}};u.$$formValidate=function(){return u.$$formValidatePromise=new Promise(function(e){var r=u.props.$validator;var t;var n;var a;var i;var o=r(u.$formutil.$params,u.$formutil);var s=function r(t){return e(_(a,t))};if(k(o)){if(!u.$$formPending){u.$$formPending=true;u.$render()}n=function e(r){return t=r(s)};i=o.then(function(){return void 0},function(e){return e}).then(function(e){if(t){return t}u.$shouldCancelPrevAsyncValidate=null;u.$$formPending=false;return u.$$setFormErrors(e,s)})}else{if(u.$$formPending){u.$$formPending=false}i=u.$$setFormErrors(o,s)}if(u.$shouldCancelPrevAsyncValidate){u.$shouldCancelPrevAsyncValidate(function(e){a=e;return i})}u.$shouldCancelPrevAsyncValidate=n})};u.$$setFormErrors=function(e,n){if(e&&(e instanceof Error||typeof e!=="object")){v(false,"The result of $validator in <Form /> should always return None(null,undefined) or an object contains error message of Field.");return u.$render(n)}return u.$$setStates(e||{},function(e,n){var a=n.$getState(),i=a.$error,u=i===void 0?{}:i;if(e){return{$error:t({},u,r({},Y,e))}}if(u[Y]){delete u[Y];return{$error:u}}},n,true)};u.$getField=function(e){var r=u.$$getRegister(e);v(!e||r,"$getField('".concat(e,"') fail to find the matched Field. Maybe it has been unmounted."));v(e,"You should pass a name of the mounted Field to $getField().");if(r){var t;return(t=r.$new)===null||t===void 0?void 0:t.call(r)}};u.$$onChange=function(e,t,n){return u.$setStates(r({},e,t),n)};u.$$setStates=function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var r=arguments.length>1?arguments[1]:undefined;var t=arguments.length>2?arguments[2]:undefined;var n=arguments.length>3?arguments[3]:undefined;var a=u.$$deepParseObject(e);I(u.$$registers,function(e,t){var i=N(a,t);if(n||i){var o=r(i&&i.data,e);if(o){var s=u.$formutil.$weakParams[t];var l=e.$$merge(o),$=l.$value;e.$$detectChange(o);if("$value"in o||"$viewValue"in o){var f=T(u.$$fieldChangedQueue,function(e){return e.name===t});if(f){if(!("$prevValue"in f)){f.$prevValue=f.$newValue}f.$newValue=$}else{u.$$fieldChangedQueue.push({name:t,$newValue:$,$prevValue:s})}}u.$$formShouldUpdateFields[t]=true}}});return u.$render(t)};u.$render=function(e){return new Promise(function(r){return u.forceUpdate(function(){return r(_(e,u.$formutil))})})};u.$validates=function(){var e;for(var r=arguments.length,t=new Array(r),n=0;n<r;n++){t[n]=arguments[n]}if(w(t[t.length-1])){e=t.pop()}if(t.length){var a=function e(r){r.forEach(function(r){if(Array.isArray(r)){e(r)}else{var t=u.$getField(r);if(t){t.$validate()}}})};a(t)}else{I(u.$$registers,function(e){return e.$validate()});if(w(u.props.$validator)){u.$$formValidate()}}return u.$onValidates(e)};u.$onValidates=function(e){var r=Object.keys(u.$$registers).map(function(e){return u.$$registers[e].$onValidate()});r.push(u.$$formValidatePromise);return Promise.all(r).then(function(){return _(e,u.$formutil)})};u.$validate=function(e,r){var t=u.$getField(e);if(t){return t.$validate(r)}return _(r)};u.$reset=function(e,r){u.$$defaultInitialize();if(w(e)){r=e;e={}}return u.$$setStates(e,function(e,r){return r.$$reset(e)},r,true)};u.$setStates=function(e,r){return u.$$setStates(e,function(e){return e},r)};u.$setValues=function(e,r){u.$$deepParseObject(O(e),u.$$defaultValues);M(u.$$defaultValues);return u.$$setStates(e,function(e){return{$value:e}},r)};u.$setFocuses=function(e,r){return u.$$setStates(e,function(e){return{$focused:e}},r)};u.$setDirts=function(e,r){return u.$$setStates(e,function(e){return{$dirty:e}},r)};u.$setTouches=function(e,r){return u.$$setStates(e,function(e){return{$touched:e}},r)};u.$setPendings=function(e,r){return u.$$setStates(e,function(e){return{$pending:e}},r)};u.$setErrors=function(e,r){return u.$$setStates(e,function(e){return{$error:e}},r)};u.$batchState=function(e,r){return u.$setStates(q(u.$$registers,function(){return e}),r)};u.$batchDirty=function(e,r){return u.$batchState({$dirty:e},r)};u.$batchTouched=function(e,r){return u.$batchState({$touched:e},r)};u.$batchFocused=function(e,r){return u.$batchState({$focused:e},r)};u.$batchPending=function(e,r){return u.$batchState({$pending:e},r)};u.$batchError=function(e,r){return u.$batchState({$error:e},r)};u.$getFirstError=function(e){var r=u.$formutil;if(e){var t=r.$getField(e);return t&&t.$getFirstError()}for(var n in r.$weakErrors){if(r.$weakErrors.hasOwnProperty(n)){var a=r.$weakErrors[n];for(var i in a){if(a.hasOwnProperty(i)){return a[i]instanceof Error?a[i].message:a[i]}}}}};u.$new=function(){return u.$formutil};u.$$defaultInitialize();return u}u(d,[{key:"$$deepParseObject",value:function e(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};I(r,function(e,r){return R(t,r,e)});return t}},{key:"$$resetFormUpdateFields",value:function e(){this.$$formShouldUpdateFields={};this.$$formShouldUpdateAll=false}},{key:"componentDidMount",value:function e(){U(this.props.$ref,this.$formutil)}},{key:"componentDidUpdate",value:function e(r){var t=this;U(this.props.$ref,this.$formutil);z(this.$$triggerChangeTimer);this.$$triggerChangeTimer=Q(function(){t.$$triggerFormChange()})}},{key:"componentWillUnmount",value:function e(){U(this.props.$ref,null)}},{key:"_render",value:function e(){var r=this.$formutil;var t=this.props,n=t.children,a=t.render,i=t.component;if(i){return f.createElement(i,{$formutil:r})}if(w(a)){return a(r)}if(w(n)){return n(r)}return f.Children.map(n,function(e){return e&&E(e.type)?f.cloneElement(e,{$formutil:r}):e})}},{key:"render",value:function e(){var r=this;var n=this.props.$processer;var a=Object.keys(this.$$registers).map(function(e){return{path:e,$state:r.$$registers[e].$getState()}});var i=this.$$formShouldUpdateAll;var u=this.$formutil||{};var o=a.some(function(e){var r=e.$state;return r.$invalid});var s=a.some(function(e){var r=e.$state;return r.$dirty});var l=a.some(function(e){var r=e.$state;return r.$touched});var $=a.some(function(e){var r=e.$state;return r.$focused});var f=this.$$formPending||a.some(function(e){var r=e.$state;return r.$pending});var d=i?{}:t({},u.$pureParams);var v=i?{}:t({},u.$states);var h=i?{}:t({},u.$errors);var p=i?{}:t({},u.$dirts);var m=i?{}:t({},u.$touches);var y=i?{}:t({},u.$focuses);var F=i?{}:t({},u.$pendings);var b=i?{}:t({},u.$weakStates);var w=i?{}:t({},u.$weakParams);var V=i?{}:t({},u.$weakErrors);var k=i?{}:t({},u.$weakDirts);var P=i?{}:t({},u.$weakFocuses);var S=i?{}:t({},u.$weakTouches);var E=i?{}:t({},u.$weakPendings);for(var O=0,_=a.length;O<_;O++){var x=a[O],j=x.$state,A=x.path;if(!i){if(!this.$$formShouldUpdateFields[A]){continue}}if(n){n(j,A)}if(A in w&&j.$pristine&&C(j.$value)){delete w[A];L(d,A)}else if(w[A]!==j.$value){w[A]=j.$value;R(d,A,j.$value)}R(v,A,j);b[A]=j;if(V[A]!==j.$error){if(j.$invalid){R(h,A,j.$error);V[A]=j.$error}else if(A in V){L(h,A);delete V[A]}}if(k[A]!==j.$dirty){R(p,A,j.$dirty);k[A]=j.$dirty}if(S[A]!==j.$touched){R(m,A,j.$touched);S[A]=j.$touched}if(P[A]!==j.$focused){R(y,A,j.$focused);P[A]=j.$focused}if(E[A]!==j.$pending){R(F,A,j.$pending);E[A]=j.$pending}}this.$formutil={$$registers:t({},this.$$registers),$$deepRegisters:this.$$deepRegisters,$states:v,$pureParams:d,$params:t({},this.$$defaultValues,{},d),$errors:h,$dirts:p,$touches:m,$focuses:y,$pendings:F,$weakStates:b,$weakParams:w,$weakErrors:V,$weakDirts:k,$weakTouches:S,$weakFocuses:P,$weakPendings:E,$getFirstError:this.$getFirstError,$render:this.$render,$getField:this.$getField,$onValidates:this.$onValidates,$new:this.$new,$setStates:this.$setStates,$setValues:this.$setValues,$setErrors:this.$setErrors,$setTouches:this.$setTouches,$setDirts:this.$setDirts,$setFocuses:this.$setFocuses,$setPendings:this.$setPendings,$batchState:this.$batchState,$batchTouched:this.$batchTouched,$batchDirty:this.$batchDirty,$batchFocused:this.$batchFocused,$batchPending:this.$batchPending,$reset:this.$reset,$validates:this.$validates,$validate:this.$validate,$valid:!o,$invalid:o,$dirty:s,$pristine:!s,$touched:l,$untouched:!l,$focused:$,$pending:f};this.$$resetFormUpdateFields();return c.createElement(g.Provider,{value:this.getFormContext},this._render())}}]);return d}(f.Component);G.displayName="React.Formutil.Form";G.defaultProps={$defaultValues:{},$defaultStates:{}};var K=["render","component","children","$defaultValues","$defaultStates","$onFormChange","$validator","$processer","$ref"];function W(e){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=function(n){$(a,n);function a(){var r;var t;i(this,a);for(var n=arguments.length,u=new Array(n),l=0;l<n;l++){u[l]=arguments[l]}t=o(this,(r=s(a)).call.apply(r,[this].concat(u)));t.renderChildren=function(r){return c.createElement(e,Object.assign({},t.othersProps,{$formutil:r,ref:t.props.__forwardRef__}))};return t}u(a,[{key:"render",value:function e(){var n=Object.assign({},this.props);var a=this.props,i=a.component,u=h(a,["component"]);K.forEach(function(e){if(e in n){if(e==="$defaultStates"||e==="$defaultValues"){u[e]=t({},r[e],{},n[e])}delete n[e]}});this.othersProps=n;return c.createElement(G,Object.assign({},r,u,{render:this.renderChildren}))}}]);return a}(f.Component);n.displayName="React.Formutil.withForm."+(e.displayName||e.name||"Anonymous");var a=f.forwardRef(function(e,r){return c.createElement(n,Object.assign({__forwardRef__:r},e))});a.displayName="React.Formutil.withForm.ForwardRef."+(e.displayName||e.name||"Anonymous");return p(a,e)}var J=x(W);var X=0;var Z={$valid:true,$invalid:false,$dirty:false,$pristine:true,$touched:false,$untouched:true,$focused:false,$pending:false,$error:{}};function ee(e){return e!==true}function re(e,r,t){v(!C(e),"You should return a string or Error when the validation('".concat(t&&t+": ").concat(r,"') failed, otherwise return true."))}var te="React.Formutil.Field";function ne(){return X++}function ae(e,r){var t=r.children,n=r.render,a=r.component;if(a){return f.createElement(a,{$fieldutil:e})}if(w(n)){return n(e)}if(w(t)){return t(e)}return f.Children.map(t,function(r){return r&&E(r.type)?f.cloneElement(r,{$fieldutil:e}):r})}function ie(e,r){var n={$$FIELD_UUID:e.$$FIELD_UUID,$$reset:s,$$merge:F,$$detectChange:i,$$triggerChange:u,$onValidate:o,$new:function r(){return e.$fieldutil},$picker:l,$getState:l,$getComponent:function e(){return r},$reset:function r(t,n){return e.$setState(s(t),n)},$getFirstError:y,$validate:$,$setState:e.$setState,$render:f,$setValue:c,$setTouched:d,$setDirty:v,$setFocused:h,$setValidity:m,$setError:p,$setPending:g};var a;function i(e){if("$value"in e||"$viewValue"in e){$()}}function u(r){var t=r.$newValue,n=r.$prevValue;var a=e.props.$onFieldChange;if(w(a)){a(t,n,e.$formContext.$formutil)}}function o(e){a.then(e);return a}function s(r){var n;var a=e.props,i=e.$formContext;if(i.$$getDefault){var u=a.name;var o=i.$$getDefault(),s=o.$$defaultStates,l=o.$$defaultValues;if(u&&l){var $=R(l,u);n=R(s,u)||{};if(!C($)){n.$value=$}}}var f=a.$defaultValue,c=a.$defaultState;return F(t({},Z,{},w(c)?c(a):c,{$value:w(f)?f(a):"$defaultValue"in a?f:""},n,{},r))}function l(){return t({},e.$state)}function $(r){return a=new Promise(function(n){var a=e.props,i=e.$formContext;var u=t({},a.$validators,{},a.$asyncValidators);var o=e.$state,s=o.$value,l=o.$pending,$=Object.assign({},o.$error);var f=i.$formutil;var c={};var d=false;var v;var h;var y;var F;delete $[Y];var b=Object.keys(u).reduce(function(r,n){delete $[n];if(!d&&a[n]!=null){var i=u[n](s,a[n],t({},a,{$formutil:f,$fieldutil:e.$fieldutil,$validError:c}));if(k(i)){r.push(i["catch"](function(e){if(!v){m(n,e||n)}}))}else if(ee(i)){c[n]=i||n;re(i,n,a.name);if(a.$validateLazy){d=true}}}return r},[]);var C=function e(t){return n(_(r,_(y,t)))};if(b.length){if(!l){g(true)}h=function e(r){return v=r(C)};b.push(p(t({},$,{},c)));F=Promise.all(b).then(function(){if(v){return v}e.$shouldCancelPrevAsyncValidate=null;return g(false,C)})}else{if(l){g(false)}F=p(t({},$,{},c),C)}if(e.$shouldCancelPrevAsyncValidate){e.$shouldCancelPrevAsyncValidate(function(e){y=e;return F})}e.$shouldCancelPrevAsyncValidate=h})}function f(r,t){return e.$setState({$viewValue:r,$dirty:true},t)}function c(r,t){return e.$setState({$value:r},t)}function d(r,t){return e.$setState({$touched:r},t)}function v(r,t){return e.$setState({$dirty:r},t)}function h(r,t){return e.$setState({$focused:r},t)}function p(r,t){return e.$setState({$error:r},t)}function m(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var n=arguments.length>2?arguments[2]:undefined;var a=Object.assign({},e.$state.$error);if(ee(t)){a[r]=t||r;re(t,r,e.props.name)}else{delete a[r]}return p(a,n)}function g(r,t){return e.$setState({$pending:r},t)}function y(){var r=e.$state.$error,t=r===void 0?{}:r;for(var n in t){if(t.hasOwnProperty(n)){return t[n]instanceof Error?t[n].message:t[n]}}}function F(r){var n=Object.assign({},r);if("$error"in n){if(!n.$error){n.$error={}}n.$valid=Object.keys(n.$error).length===0}var a=e.props,i=a.$parser,u=a.$formatter;if("$viewValue"in n&&!("$value"in n)){var o=function e(r){return n.$viewValue=r};n.$value=i?i(n.$viewValue,o):n.$viewValue}else if("$value"in n&&!("$viewValue"in n)){var s=function e(r){return n.$value=r};n.$viewValue=u?u(n.$value,s):n.$value}if("$valid"in n){n.$invalid=!n.$valid}else if("$invalid"in n){n.$dirty=!n.$invalid}if("$dirty"in n){n.$pristine=!n.$dirty}else if("$pristine"in n){n.$dirty=!n.$pristine}if("$touched"in n){n.$untouched=!n.$touched}else if("$untouched"in n){n.$touched=!n.$untouched}e.$state=t({},e.$state,{},n);return l()}return n}var ue=function(e){$(r,e);function r(){var e;var t;i(this,r);for(var n=arguments.length,a=new Array(n),u=0;u<n;u++){a[u]=arguments[u]}t=o(this,(e=s(r)).call.apply(e,[this].concat(a)));t.$$FIELD_UUID=ne();t.$formContext=void 0;t.$state=void 0;t.shouldRendered=false;t.$setState=function(e,r){return new Promise(function(n){var a=function e(){return n(_(r,t.$fieldutil))};if(t.isMounting){var i=t.props.name;if(i in(t.$formContext.$$registers||{})){t.shouldRendered=false;t.$formContext.$$onChange(i,e,a);if(!t.shouldRendered){t.forceUpdate()}}else{t.$registered.$$merge(e);t.$registered.$$detectChange(e);t.forceUpdate(a)}}else{t.$registered.$$merge(e);a()}})};return t}u(r,[{key:"componentDidMount",value:function e(){this.isMounting=true;var r=this.props.name,t=this.$formContext;v(!r||t.$formutil,"You should enusre that the <Field /> with the name '".concat(r,"' must be used underneath a <Form /> component or withForm() HOC, otherwise it's isolated."));v(r,"You should assign a name to <Field />, otherwise it will be isolated!");if(t.$$register){t.$$register(r,this.$fieldHandler)}this.$prevState=this.$state;U(this.props.$ref,this.$fieldutil)}},{key:"componentWillUnmount",value:function e(){if(this.$formContext.$$unregister){this.$formContext.$$unregister(this.props.name,this.$fieldHandler,this.props.$reserveOnUnmount)}this.isMounting=false;U(this.props.$ref,null)}},{key:"componentDidUpdate",value:function e(r){var t=this.props.name;if(t!==r.name){if(this.$formContext.$$register){this.$formContext.$$register(t,this.$fieldHandler,r.name)}}U(this.props.$ref,this.$fieldutil);if(this.$state.$value!==this.$prevState.$value){if(!(t in(this.$formContext.$$registers||{}))){this.$registered.$$triggerChange({$newValue:this.$state.$value,$prevValue:this.$prevState.$value})}}this.$prevState=this.$state}},{key:"shouldComponentUpdate",value:function e(r){var t=r.$memo;return!t||!B(this.$registered.$getState(),this.$prevState)||!(Array.isArray(t)?m(t,this.props.$memo):m(this.props,r))}},{key:"_render",value:function e(){var r=this.$fieldutil=t({$name:this.props.name},this.$registered.$getState(),{},this.$registered,{$$formutil:this.$formContext.$formutil});return ae(r,this.props)}},{key:"render",value:function e(){var r=this;this.shouldRendered=true;return c.createElement(g.Consumer,null,function(e){var t=!r.$formContext;r.$formContext=e();if(!r.$fieldHandler){r.$fieldHandler=ie(r,r)}r.$registered=(r.$formContext.$$registers||{})[r.$fieldHandler.$name]||r.$fieldHandler;if(t){r.$fieldHandler.$$reset();r.$fieldHandler.$validate()}return r._render()})}}]);return r}(f.Component);ue.displayName=te;var oe=["name","$defaultValue","$defaultState","$onFieldChange","$validators","$asyncValidators","$validateLazy","$memo","$reserveOnUnmount","$ref","$parser","$formatter","render","component","children"];function se(e){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=function(n){$(a,n);function a(){var r;var t;i(this,a);for(var n=arguments.length,u=new Array(n),l=0;l<n;l++){u[l]=arguments[l]}t=o(this,(r=s(a)).call.apply(r,[this].concat(u)));t.renderChildren=function(r){return c.createElement(e,Object.assign({},t.othersProps,{$fieldutil:r,ref:t.props.__forwardRef__}))};return t}u(a,[{key:"render",value:function e(){var n=Object.assign({},this.props);var a=this.props,i=a.component,u=h(a,["component"]);oe.concat(Object.keys(t({},r.$validators,{},r.$asyncValidators,{},n.$validators,{},n.$asyncValidators))).forEach(function(e){if(e in n){if(e==="$validators"||e==="$asyncValidators"||e==="$defaultState"){u[e]=t({},r[e],{},n[e])}delete n[e]}});this.othersProps=n;return c.createElement(ue,Object.assign({},r,u,{render:this.renderChildren}))}}]);return a}(f.Component);n.displayName="React.Formutil.withField."+(e.displayName||e.name||"Anonymous");var a=f.forwardRef(function(e,r){return c.createElement(n,Object.assign({__forwardRef__:r},e))});a.displayName="React.Formutil.withField.ForwardRef."+(e.displayName||e.name||"Anonymous");return p(a,e)}var le=x(se);var $e=function(e){$(r,e);function r(){i(this,r);return o(this,s(r).apply(this,arguments))}u(r,[{key:"render",value:function e(){var r=this;var t=this.props,n=t.$fieldutil,a=t.value,i=t.onChange,u=t.onFocus,o=t.onBlur,s=t.checked,l=t.unchecked,$=h(t,["$fieldutil","value","onChange","onFocus","onBlur","checked","unchecked"]);var f=this.props.type;var d={value:"compositionValue"in this?this.compositionValue:a,onCompositionEnd:function e(t){r.composition=false;delete r.compositionValue;d.onChange(t)},onCompositionStart:function e(){return r.composition=true},onChange:function e(t){var n=t.target.value;if(r.composition){r.compositionValue=n;r.forceUpdate()}else{i(n,t)}},onFocus:u,onBlur:o};var v="input";switch(f){case"select":v=f;d.onChange=function(e){var r=e.target;var t=r.multiple?[].slice.call(r.options).filter(function(e){return e.selected}).map(function(e){return e.value}):r.value;i(t,e)};delete $.type;break;case"textarea":v=f;delete $.type;break;case"checkbox":case"radio":d={checked:a===s,onChange:function e(r){i(r.target.checked?s:l,r)},onFocus:u,onBlur:o};break}return c.createElement(v,Object.assign({},$,d))}}]);return r}(f.Component);$e.displayName="React.Formutil.EasyField.Native";$e.defaultProps={value:"",type:"text",checked:true,unchecked:false};var fe=f.createContext(function(){return{}}),ce=fe.Provider,de=fe.Consumer;var ve=function(e){$(r,e);function r(){var e;var t;i(this,r);for(var n=arguments.length,a=new Array(n),u=0;u<n;u++){a[u]=arguments[u]}t=o(this,(e=s(r)).call.apply(e,[this].concat(a)));t.getGroupContext=function(){return t.props};return t}u(r,[{key:"_render",value:function e(){var r=this.props,t=r.className,n=r.groupNode,a=r.children;var i={GroupOption:he,Field:pe};var u=w(a)?a(i):f.Children.map(a,function(e){return f.cloneElement(e,i)});if(n===null){return u}return c.createElement(n,{className:t},u)}},{key:"render",value:function e(){return c.createElement(ce,{value:this.getGroupContext},this._render())}}]);return r}(f.Component);ve.displayName="React.Formutil.EasyField.Group";ve.defaultProps={type:"checkbox",groupNode:"div"};var he=function(e){$(r,e);function r(){i(this,r);return o(this,s(r).apply(this,arguments))}u(r,[{key:"componentDidMount",value:function e(){v("$value"in this.props,"You should pass a $value to <GroupOption />.")}},{key:"render",value:function e(){var r=this.props,t=r.$value,n=r.onChange,a=r.onFocus,i=r.onBlur,u=h(r,["$value","onChange","onFocus","onBlur"]);return c.createElement(de,null,function(e){var r=e();var o=r.type,s=r.name;var l=o==="radio"?{checked:r.value===t,onChange:function e(a){r.onChange(t,a);n&&n(a)}}:o==="checkbox"?{checked:r.value.indexOf(t)>-1,onChange:function e(a){r.onChange(a.target.checked?r.value.concat(t):r.value.filter(function(e){return e!==t}),a);n&&n(a)}}:{value:r.value,onChange:function e(t){r.onChange(t);n&&n(t)}};return c.createElement("input",Object.assign({name:s},u,l,{type:o,onFocus:function e(t){r.onFocus(t);a&&a(t)},onBlur:function e(t){r.onBlur(t);i&&i(t)}}))})}}]);return r}(f.Component);he.displayName="React.Formutil.EasyField.Group.Option";var pe=function(e){$(r,e);function r(){i(this,r);return o(this,s(r).apply(this,arguments))}u(r,[{key:"componentDidMount",value:function e(){v(false,'The "Field" property in EasyField\'s children-props has been deprecated. Please use "GroupOption" instead.')}},{key:"render",value:function e(){return c.createElement(he,this.props)}}]);return r}(f.Component);pe.displayName="React.Formutil.EasyField.Group.Option.Deprecated";var me=c.Frament||"div";var ge=function(e){$(r,e);function r(e){var t;i(this,r);t=o(this,s(r).call(this,e));t.id=0;t.latestValue=t.props.value;t.$formutil=void 0;t.FieldValidators={required:function e(r){return r!==null}};t.$onFormChange=function(e){e.$onValidates(function(e){var r=e.$invalid,n=e.$params;if(r){if(t.props.value.length){t.props.onChange(t.latestValue=[])}}else if(!m(t.props.value,n.list)){t.props.onChange(t.latestValue=n.list)}})};t.swap=function(e,r,n){return t.$setState(function(t){var n=t.items;var a=[n[e],n[r]];n[r]=a[0];n[e]=a[1];return n},n)};t.insert=function(){var e,r,n;for(var a=arguments.length,i=new Array(a),u=0;u<a;u++){i[u]=arguments[u]}i.forEach(function(t){if(w(t)){n=t}else if(typeof t==="number"){e=t}else if(typeof t==="object"){r=t}});return t.$setState(function(n){var a=n.items;if(C(e)){a.push(t.getId(r))}else{a.splice(e,0,t.getId(r))}return{items:a}},n)};t.remove=function(){var e,r;for(var n=arguments.length,a=new Array(n),i=0;i<n;i++){a[i]=arguments[i]}a.forEach(function(t){if(w(t)){r=t}else if(typeof t==="number"){e=t}});return t.$setState(function(r){var n=r.items;if(C(e)){n.pop()}else{n.splice(e,1)}if(!n.length){n=[t.getId()]}return{items:n}},r)};t.$setState=function(e,r){return new Promise(function(n){return t.setState(e,function(){return t.$formutil.$onValidates(function(e){return n(_(r,e))})})})};t.state={items:e.value.length?e.value.map(function(){return t.getId()}):[t.getId()],formKey:0};return t}u(r,[{key:"componentDidUpdate",value:function e(r){var t=this;if(this.props.value!==this.latestValue){this.setState({items:this.props.value.length?this.props.value.map(function(){return t.getId()}):[this.getId()],formKey:this.state.formKey+1});this.latestValue=this.props.value}}},{key:"getId",value:function e(r){return{id:this.id++,values:r}}},{key:"render",value:function e(){var r=this;var n=this.props,a=n.children,i=n.onFocus,u=n.onBlur,o=n.value;var s=this;if(!w(a)){return null}var l={$insert:this.insert,$remove:this.remove,$swap:this.swap,$push:function e(t,n){return r.insert(t,n)},$pop:function e(t){return r.remove(t)},$shift:function e(t){return r.remove(0,t)},$unshift:function e(t,n){return r.insert(0,t,n)},onFocus:i,onBlur:u};return c.createElement(G,{key:this.state.formKey,$defaultValues:{list:o},$onFormChange:this.$onFormChange,children:function e(n){r.$formutil=n;return c.createElement(me,null,r.state.items.map(function(e,i){var u=e.id,o=e.values;return c.createElement(ue,{key:u,required:true,$defaultValue:o||null,$validators:r.FieldValidators,name:"list[".concat(i,"]"),children:function e(u){return c.createElement(G,{$defaultValues:u.$value||{},$onFormChange:function e(r){return r.$onValidates(function(e){var r=e.$invalid,t=e.$params;if(r){if(u.$viewValue!==null){u.$render(null)}}else if(!m(u.$viewValue,t)){u.$render(t)}})},children:function e(u){return a(t({get $length(){return s.state.items.length},$index:i,$isLast:function e(){return i===r.state.items.length-1},$isFirst:function e(){return i===0}},l,{},u),n)}})}})}))}})}}]);return r}(f.Component);ge.displayName="React.Formutil.EasyField.List";var ye="__TYPE__";var Fe=[["required",function(e,r,t){var n=t.__TYPE__,a=t.checked,i=a===void 0?true:a;return n==="checked"?e===i:!V(e)}],["maxLength",function(e,r,t){return t.required&&V(e)||e.length<=r}],["minLength",function(e,r,t){return t.required&&V(e)||e.length>=r}],["max",function(e,r,t){return t.required&&V(e)||e*1<=r}],["min",function(e,r,t){return t.required&&V(e)||e*1>=r}],["pattern",function(e,r,t){return t.required&&V(e)||r.test(e)}],["enum",function(e,r,t){return t.required&&V(e)||r.indexOf(e)>-1}],["checker",function(e,r,t){return r(e,t)}]].reduce(function(e,r){var t=a(r,2),n=t[0],i=t[1];e[n]=function e(r,t,a){var u=a.validMessage,o=u===void 0?{}:u;return i.apply(void 0,arguments)||o[n]||"Error input: ".concat(n)};return e},{});var be="React.Formutil.EasyField";var Ce={validMessage:{},valuePropName:"value",changePropName:"onChange",focusPropName:"onFocus",blurPropName:"onBlur",$parser:function e(r){return typeof r==="string"?r.trim():r}};function we(e,n,a){var i;var u=n.valuePropName,o=n.changePropName,s=n.focusPropName,l=n.blurPropName,$=n.getValueFromEvent,f=n.passUtil;var c=function e(r){return r&&r.target?r.target[u]:r};var d=t({},a,(i={},r(i,u,e.$viewValue),r(i,o,function(r){var t;for(var a=arguments.length,i=new Array(a>1?a-1:0),u=1;u<a;u++){i[u-1]=arguments[u]}if(((t=i[0])===null||t===void 0?void 0:t.nativeEvent)instanceof Event){i.push(r)}else{i.unshift(r)}var s=n[o];s&&s.apply(void 0,i);var l=$?$.apply(void 0,i):c(r);e.$render(l)}),r(i,s,function(){var r=n[s];r&&r.apply(void 0,arguments);e.$setFocused(true)}),r(i,l,function(){var r=n[l];r&&r.apply(void 0,arguments);if(e.$untouched){e.$setTouched(true)}e.$setFocused(false)}),i));if(f){d[f===true?"$fieldutil":String(f)]=e}return d}function Ve(e){var r=e.children,n=e.component,i=e.render,u=h(e,["children","component","render"]);var o=u.name,s=u.type,l=u.defaultValue,$=u.valuePropName,f=u.changePropName,c=u.focusPropName,d=u.blurPropName,v=u.getValueFromEvent,p=u.validMessage,m=u.checked,g=u.unchecked,y=u.__TYPE__,F=u.__DIFF__,b=u.passUtil,w=u.$defaultValue,V=u.$defaultState,k=u.$onFieldChange,P=u.$validators,S=u.$asyncValidators,E=u.$validateLazy,O=u.$memo,_=u.$reserveOnUnmount,x=u.$parser,j=u.$formatter,D=u.$ref,R=h(u,["name","type","defaultValue","valuePropName","changePropName","focusPropName","blurPropName","getValueFromEvent","validMessage","checked","unchecked","__TYPE__","__DIFF__","passUtil","$defaultValue","$defaultState","$onFieldChange","$validators","$asyncValidators","$validateLazy","$memo","$reserveOnUnmount","$parser","$formatter","$ref"]);var N={children:r,component:n,render:i};if(O===true&&C(F)){u.__DIFF__=[r,n,i]}var U=!C(s)||C(r)&&C(n)&&C(i);Object.keys(t({},u.$validators=t({},Fe,{},u.$validators),{},u.$asyncValidators)).forEach(function(e){if(e in R){if(!U||!A(e)){delete R[e]}}});if(U){var T=(s||"").split("."),q=a(T,2),I=q[0],H=I===void 0?"text":I,M=q[1];N.component=H==="group"?ve:H==="list"?ge:$e;if(o){R.name=o}if(s){R.type=H}if(r){R.children=r}R.checked=m;R.unchecked=g;switch(H){case"select":case"textarea":if(e.multiple){u[ye]="array"}break;case"group":if(M==="checkbox"){u[ye]="array"}R.type=M;break;case"checkbox":case"radio":u[ye]="checked";break;case"list":u[ye]="array";break}}if(!("$defaultValue"in u)&&"defaultValue"in e){u.$defaultValue=l}if(!("$defaultValue"in u)&&ye in u){var L;switch(u[ye]){case"checked":var B=u.unchecked,Y=B===void 0?false:B;L=Y;break;case"array":L=[];break;case"object":L={};break;case"number":L=0;break}u.$defaultValue=L}return{fieldProps:u,childProps:R,renderProps:N}}function ke(e,r){var t=r.component,n=r.render,a=r.children;if(t){return f.createElement(t,e)}if(w(n)){return n(e)}if(w(a)){return a(e)}return f.Children.map(a,function(r){return f.cloneElement(r,e)})}var Pe=function(e){$(r,e);function r(){var e;var t;i(this,r);for(var n=arguments.length,a=new Array(n),u=0;u<n;u++){a[u]=arguments[u]}t=o(this,(e=s(r)).call.apply(e,[this].concat(a)));t.renderChildren=function(e){var r=t.parsedProps,n=r.fieldProps,a=r.childProps,i=r.renderProps;return ke(we(e,n,a),i)};t.parsedProps={};return t}u(r,[{key:"render",value:function e(){var r=this.parsedProps=Ve(this.props),t=r.fieldProps;return c.createElement(ue,Object.assign({},t,{children:this.renderChildren}))}}]);return r}(f.Component);Pe.displayName=be;Pe.defaultProps=Ce;function Se(e){var r=f.forwardRef(function(r,t){return c.createElement(g.Consumer,null,function(n){return c.createElement(e,Object.assign({},r,{$formutil:n().$formutil,ref:t}))})});r.displayName="React.Formutil.connect."+(e.displayName||e.name||"Anonymous");return p(r,e)}function Ee(){if(!c.useState){throw new Error("Hooks api need react@>=16.8, Please upgrade your reactjs.")}var e=c.useContext;var r=e(g);return r()}function Oe(e){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!c.useState){throw new Error("Hooks api need react@>=16.8, Please upgrade your reactjs.")}var i=c.useState,u=c.useLayoutEffect,o=c.useRef;var s;if(e){if(typeof e==="string"){s=e;r.name=s}else{r=e;s=r.name}}var l=Ee();var $=o({}).current;var f=o([]);var d;$.$formContext=l;$.props=r;$.$setState=g;$.shouldRendered=true;var h=i(function(){$.$$FIELD_UUID=ne();$.$fieldHandler=d=ie($);$.$fieldHandler.$$reset();$.$fieldHandler.$validate()}),p=a(h,2),m=p[1];if(!d){d=(l.$$registers||{})[$.$fieldHandler.$name]||$.$fieldHandler}u(function(){var e=$.$state;if($.isMounting){if(!(s in(l.$$registers||{}))){d.$$triggerChange({$newValue:e.$value,$prevValue:$.$prevState.$value})}}$.$prevState=e},[$.$state.$value]);u(function(){$.isMounting=true;v(!s||l.$formutil,"You should enusre that the useField() with the name '".concat(s,"' must be used underneath a <Form /> component or withForm() HOC, otherwise it's isolated."));v(s,"You should pass a name argument to useField(), otherwise it will be isolated!");return function(){$.isMounting=false;U(r.$ref,null)}},[]);u(function(){if(l.$$register){l.$$register(s,$.$fieldHandler)}return function(){if(l.$$unregister){l.$$unregister(s,$.$fieldHandler,!$.isMounting&&r.$reserveOnUnmount)}}},[s]);u(function(){U(r.$ref,$.$fieldutil)});u(function(){if(f.current.length>0){var e=n(f.current);f.current.length=0;while(e.length){e.pop()($.$fieldutil)}}});function g(e,r){return new Promise(function(t){var n=function e(){return t(_(r,$.$fieldutil))};if($.isMounting){if(s in(l.$$registers||{})){$.shouldRendered=false;l.$$onChange(s,e,n);if(!$.shouldRendered){m({})}}else{d.$$merge(e);d.$$detectChange(e);m({});f.current.push(n)}}else{d.$$merge(e);n()}})}return $.$fieldutil=t({$name:s},d.$getState(),{},d,{$$formutil:l.$formutil})}function _e(){var e=Ee(),r=e.$formutil;return r}function xe(e){e=t({},Ce,{},e,{children:null});var r=Ve(e),n=r.fieldProps,a=r.childProps;var i=Oe(n);return we(i,n,a)}exports.EasyField=Pe;exports.Field=ue;exports.Form=G;exports.connect=Se;exports.formContext=g;exports.useField=Oe;exports.useForm=_e;exports.useHandler=xe;exports.withField=le;exports.withForm=J;
