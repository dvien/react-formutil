"use strict";Object.defineProperty(exports,"__esModule",{value:true});function e(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var t=require("react");var r=e(t);var n=e(require("create-react-context"));var i=e(require("warning"));var a=e(require("hoist-non-react-statics"));var u=e(require("react-fast-compare"));function o(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function s(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};var n=Object.keys(r);if(typeof Object.getOwnPropertySymbols==="function"){n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))}n.forEach(function(t){o(e,t,r[t])})}return e}function l(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++){r[t]=e[t]}return r}}function $(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function f(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function c(e){return l(e)||$(e)||f()}function d(e){if(Array.isArray(e))return e}function v(e,t){var r=[];var n=true;var i=false;var a=undefined;try{for(var u=e[Symbol.iterator](),o;!(n=(o=u.next()).done);n=true){r.push(o.value);if(t&&r.length===t)break}}catch(e){i=true;a=e}finally{try{if(!n&&u["return"]!=null)u["return"]()}finally{if(i)throw a}}return r}function p(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function h(e,t){return d(e)||v(e,t)||p()}function m(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function g(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}function y(e,t,r){if(t)g(e.prototype,t);if(r)g(e,r);return e}function b(e){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){b=function e(t){return typeof t}}else{b=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return b(e)}function V(e){if(typeof Symbol==="function"&&b(Symbol.iterator)==="symbol"){V=function e(t){return b(t)}}else{V=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":b(t)}}return V(e)}function w(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function C(e,t){if(t&&(V(t)==="object"||typeof t==="function")){return t}return w(e)}function F(e){F=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)};return F(e)}function k(e,t){k=Object.setPrototypeOf||function e(t,r){t.__proto__=r;return t};return k(e,t)}function P(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});if(t)k(e,t)}var S=n({});var E=Object.getPrototypeOf({});var O=/\s*(?:\]\s*\.|\]\s*\[|\.|\[|\])\s*/g;var j=x(window)?global:window;function x(e){return typeof e==="undefined"}function D(e){return typeof e==="function"}function N(e){return x(e)||e===null||e+""===""}function _(e){return!!e&&D(e.then)}function A(e){return Object.prototype.toString.call(e)==="[object Object]"}function T(e){if(!A(e))return false;if(null===Object.getPrototypeOf(e))return true;if(!D(e.constructor))return false;return e.constructor.prototype===E}function R(e){if(e&&typeof e==="object"){if(Array.isArray(e)){var t=[];for(var r=0,n=e.length;r<n;r++){t[r]=R(e[r])}return t}else if(T(e)){var i={};for(var a in e){i[a]=R(e[a])}return i}}return e}var U=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++){n[i-1]=arguments[i]}if(D(t)){t.apply(void 0,n)}return n[0]};function I(e){return function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}if(D(r[0])){return e.apply(void 0,r)}return function(t){return e(t,r[0])}}}var H=["minlength","maxlength","max","min","required","pattern","step"];function M(e){return H.indexOf(e.toLowerCase())>-1}var L=function e(t){try{var r=new Function("origin","global","return typeof ".concat(t," === 'number' || (typeof ").concat(t," !== 'undefined' && !(origin in global)) ? ").concat(t," : origin"));return r(t,j)}catch(e){return t}};var q=function e(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}var a=r[0],u=r[1],o=r[2];i(typeof u==="string","The second parameter(".concat(JSON.stringify(u),") of parsePath() must be a string."));var s=(u.match(O)||[]).map(function(e){return e.replace(/\s/g,"")});var l=u.split(O).map(function(e){return e.trim()}).filter(function(e){return e!==""});var $=a;try{if(r.length<3){for(var f=0,c=l.length;f<c;f++){var d=L(l[f]);if(f+1===c){return $[d]}if(x($[d])){break}$=$[d]}}else{for(var v=0,p=l.length;v<p;v++){var h=L(l[v]);var m=l[v+1];var g=s[v];if(x(m)){$[h]=o;break}switch(g){case"].":case".":$=x($[h])?$[h]={}:$[h];break;case"][":case"[":var y=L(m);$=x($[h])?$[h]=typeof y==="number"&&y>=0?[]:{}:$[h];break;default:$[h]=o;break}}}}catch(e){i(false,"The name '%s' of Field seems is not a legal expression.",u)}if(r.length>2){return a}};var B=function e(t,r){for(var n=0,i=t.length;n<i;n++){if(r(t[n])===true){return t[n]}}};var Y=function e(t,r){return Object.keys(t).reduce(function(e,n){e[n]=r(t[n],n,t);return e},{})};var Q=function e(t,r){return Object.keys(t).forEach(function(e){return r(t[e],e,t)})};var G=function e(t,r){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return t.reduce(function(){r.apply(void 0,arguments);return arguments.length<=0?undefined:arguments[0]},n)};var z=undefined;var K=function e(t,r,n){Q(t,function(r,n){if(r===z){delete t[n]}else if(r&&typeof r==="object"){e(r,n,t)}});if(n&&Object.keys(t).every(function(e){return t[e]===z})){n[r]=z;e(n)}};var J=function e(t,r){if(!x(q(t,r))){q(t,r,z);K(t)}};var W="FORM_VALIDATE_RESULT";var X,Z;if(typeof requestAnimationFrame==="function"){X=requestAnimationFrame;Z=cancelAnimationFrame}else{X=setTimeout;Z=clearTimeout}var ee=function(e){P(n,e);function n(e){var t;m(this,n);t=C(this,F(n).call(this,e));t.$$formPending=void 0;t.$$formValidatePromise=void 0;t.$$registers={};t.$$deepRegisters={};t.$$regDuplications={};t.$$duplicateTimer=void 0;t.$$checkDuplication=function(){var e=w(t),r=e.$$regDuplications;var n;Q(r,function(e,t){var a=h(e,2),u=a[0],o=a[1];i(u.$$reserved,"The Field with a name '".concat(t,"' has been registered!"));o.$$reset(u.$getState());n=delete r[t]});if(n){t.$render()}};t.$$register=function(e,r,n){t.$$unregister(n,r);if(e){var i=t.$$getRegister(e);if(i){Z(t.$$duplicateTimer);t.$$regDuplications[e]=[i,r];t.$$duplicateTimer=X(t.$$checkDuplication)}else{t.$$fieldChangedQueue.push({name:e,$newValue:r.$getState().$value});J(t.$$defaultValues,e)}t.$$registers[r.$name=e]=r;t.createDeepRegisters();t.$render()}};t.$$unregister=function(e,r,n){if(e){if(e in t.$$regDuplications){var i=h(t.$$regDuplications[e],2),a=i[0],u=i[1];t.$$fieldChangedQueue.push({name:e,$newValue:u.$getState().$value,$prevValue:a.$getState().$value});delete t.$$regDuplications[e]}else if(t.$$registers[e]===r){if(n){r.$$reserved=true}else{delete t.$$registers[e];t.$$fieldChangedQueue.push({name:e,$prevValue:r.$getState().$value});J(t.$$defaultValues,e)}}t.createDeepRegisters();t.$render()}};t.$$defaultInitialize=function(){var e=t.props,r=e.$defaultValues,n=e.$defaultStates;t.$$defaultValues=t.$$deepParseObject(R(D(r)?r(t.props)||{}:r));t.$$defaultStates=t.$$deepParseObject(R(D(n)?n(t.props)||{}:n))};t.$$getDefault=function(){return{$$defaultStates:t.$$defaultStates,$$defaultValues:t.$$defaultValues}};t.$$triggerChangeTimer=void 0;t.$$fieldChangedQueue=[];t.$$triggerFormChange=function(){if(t.$$fieldChangedQueue.length){var e=c(t.$$fieldChangedQueue);t.$$fieldChangedQueue.length=0;var r={};var n={};var i=t.$$registers;var a=false;e.forEach(function(e){if(!(e.name in i)){delete e.$newValue}if(e.$newValue!==e.$prevValue){if("$newValue"in e&&"$prevValue"in e){var u=t.$$getRegister(e.name);if(u){u.$$triggerChange(e)}}"$newValue"in e&&q(r,e.name,e.$newValue);"$prevValue"in e&&q(n,e.name,e.$prevValue);a=true}});if(a){if(D(t.props.$validator)){t.$$formValidate()}if(D(t.props.$onFormChange)){t.props.$onFormChange(t.$formutil,r,n)}}}};t.createDeepRegisters=function(){return t.$$deepRegisters=t.$$deepParseObject(t.$$registers)};t.$$getRegister=function(e){if(e){var r=t.$$registers[e]||q(t.$$deepRegisters,e);if(r){return r}}};t.$$formValidate=function(e){return t.$$formValidatePromise=new Promise(function(r){var n=t.props.$validator;var i;var a;var u;var o;var s=n(t.$formutil.$params,t.formtutil);var l=function t(n){return r(U(e,U(u,n)))};if(_(s)){if(!t.$$formPending){t.$$formPending=true;t.$render()}a=function e(t){return i=t(l)};o=s.then(function(){return void 0},function(e){return e}).then(function(e){if(i){return i}t.$shouldCancelPrevAsyncValidate=null;t.$$formPending=false;return t.$$setFormErrors(e,l)})}else{if(t.$$formPending){t.$$formPending=false}o=t.$$setFormErrors(s,l)}if(t.$shouldCancelPrevAsyncValidate){t.$shouldCancelPrevAsyncValidate(function(e){u=e;return o})}t.$shouldCancelPrevAsyncValidate=a})};t.$$setFormErrors=function(e,r){if(e&&(e instanceof Error||typeof e!=="object")){i(false,"The result of $validator in <Form /> should always return None(null,undefined) or an object contains error message of Field.");return t.$render(r)}return t.$$setStates(e||{},function(e,t){var r=t.$getState(),n=r.$error,i=n===void 0?{}:n;if(e){return{$error:s({},i,o({},W,e))}}if(i[W]){delete i[W];return{$error:i}}return},r,true)};t.$getField=function(e){var r=t.$$getRegister(e);i(!e||r,"$getField('".concat(e,"') fail to find the matched Field. Maybe it has been unmounted."));i(e,"You should pass a name of the mounted Field to $getField().");if(r){return r.$new()}};t.$$onChange=function(e,r,n){return t.$setStates(o({},e,r),n)};t.$$setStates=function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var r=arguments.length>1?arguments[1]:undefined;var n=arguments.length>2?arguments[2]:undefined;var i=arguments.length>3?arguments[3]:undefined;var a=t.$$deepParseObject(e);var u=false;Q(t.$$registers,function(n,o){var s=o in e?e[o]:q(a,o);if(!x(s)||i){var l=r(s,n);if(l){var $=t.$formutil.$weakParams[o];var f=n.$$merge(l),c=f.$value;n.$$detectChange(l);if("$value"in l||"$viewValue"in l){var d=B(t.$$fieldChangedQueue,function(e){return e.name===o});if(d){if(!("$prevValue"in d)){d.$prevValue=d.$newValue}d.$newValue=c}else{t.$$fieldChangedQueue.push({name:o,$newValue:c,$prevValue:$})}}u=true}}});if(u){return t.$render(n)}return Promise.resolve(U(n,t.$formutil))};t.$render=function(e){return new Promise(function(r){return t.forceUpdate(function(){return r(U(e,t.$formutil))})})};t.$validates=function(){var e;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++){n[i]=arguments[i]}if(D(n[n.length-1])){e=n.pop()}if(n.length){var a=function e(r){r.forEach(function(r){if(Array.isArray(r)){e(r)}else{var n=t.$getField(r);if(n){n.$validate()}}})};a(n)}else{Q(t.$$registers,function(e){return e.$validate()});if(D(t.props.$validator)){t.$$formValidate()}}return t.$onValidates(e)};t.$onValidates=function(e){var r=Object.keys(t.$$registers).map(function(e){return t.$$registers[e].$onValidate()});r.push(t.$$formValidatePromise);return Promise.all(r).then(function(){return U(e,t.$formutil)})};t.$validate=function(e,r){var n=t.$getField(e);if(n){return n.$validate(r)}return U(r)};t.$reset=function(e,r){t.$$defaultInitialize();if(D(e)){r=e;e={}}return t.$$setStates(e,function(e,t){return t.$$reset(e)},r,true)};t.$setStates=function(e,r){return t.$$setStates(e,function(e){return e},r)};t.$setValues=function(e,r){t.$$deepParseObject(R(e),t.$$defaultValues);return t.$$setStates(e,function(e){return{$value:e}},r)};t.$setFocuses=function(e,r){return t.$$setStates(e,function(e){return{$focused:e}},r)};t.$setDirts=function(e,r){return t.$$setStates(e,function(e){return{$dirty:e}},r)};t.$setTouches=function(e,r){return t.$$setStates(e,function(e){return{$touched:e}},r)};t.$setPendings=function(e,r){return t.$$setStates(e,function(e){return{$pending:e}},r)};t.$setErrors=function(e,r){return t.$$setStates(e,function(e){return{$error:e}},r)};t.$batchState=function(e,r){return t.$setStates(Y(t.$$registers,function(){return e}),r)};t.$batchDirty=function(e,r){return t.$batchState({$dirty:e},r)};t.$batchTouched=function(e,r){return t.$batchState({$touched:e},r)};t.$batchFocused=function(e,r){return t.$batchState({$focused:e},r)};t.$batchPending=function(e,r){return t.$batchState({$pending:e},r)};t.$batchError=function(e,r){return t.$batchState({$error:e},r)};t.$$defaultInitialize();return t}y(n,[{key:"getFormContext",value:function e(){return{$$registers:this.$$registers,$$register:this.$$register,$$unregister:this.$$unregister,$$onChange:this.$$onChange,$$getDefault:this.$$getDefault,$formutil:this.$formutil}}},{key:"$$deepParseObject",value:function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};Q(t,function(e,t){return q(r,t,e)});return r}},{key:"componentDidUpdate",value:function e(){var t=this;Z(this.$$triggerChangeTimer);this.$$triggerChangeTimer=X(function(){t.$$triggerFormChange()})}},{key:"_render",value:function e(){var r=this.$formutil;var n=this.props,i=n.children,a=n.render,u=n.component;if(u){return t.createElement(u,{$formutil:r})}if(D(a)){return a(r)}if(D(i)){return i(r)}return t.Children.map(i,function(e){return e&&D(e.type)?t.cloneElement(e,{$formutil:r}):e})}},{key:"render",value:function e(){var t=this;var n=this.props.$processer;var i=Object.keys(this.$$registers).map(function(e){return{path:e,$state:t.$$registers[e].$getState()}});var a=G(i,function(e,t){var r=t.path,i=t.$state;if(n){n(i,r)}if("$value"in i&&(i.$dirty||!x(i.$value))){e[r]=i.$value}});var u=G(i,function(e,t){var r=t.path,n=t.$state;return r in a&&q(e,r,a[r])});var o=i.some(function(e){var t=e.$state;return t.$invalid});var l=i.some(function(e){var t=e.$state;return t.$dirty});var $=i.some(function(e){var t=e.$state;return t.$touched});var f=i.some(function(e){var t=e.$state;return t.$focused});var c=this.$$formPending||i.some(function(e){var t=e.$state;return t.$pending});var d=this.$formutil={$$registers:s({},this.$$registers),$$deepRegisters:this.$$deepRegisters,$states:G(i,function(e,t){var r=t.path,n=t.$state;return q(e,r,n)}),$params:s({},this.$$defaultValues,u),$errors:G(i,function(e,t){var r=t.path,n=t.$state;if(n.$invalid){q(e,r,n.$error)}}),$dirts:G(i,function(e,t){var r=t.path,n=t.$state;return q(e,r,n.$dirty)}),$touches:G(i,function(e,t){var r=t.path,n=t.$state;return q(e,r,n.$touched)}),$focuses:G(i,function(e,t){var r=t.path,n=t.$state;return q(e,r,n.$focused)}),$pendings:G(i,function(e,t){var r=t.path,n=t.$state;return q(e,r,n.$pending)}),$weakStates:G(i,function(e,t){var r=t.path,n=t.$state;return e[r]=n}),$weakParams:a,$weakErrors:G(i,function(e,t){var r=t.path,n=t.$state;if(n.$invalid){e[r]=n.$error}}),$weakDirts:G(i,function(e,t){var r=t.path,n=t.$state;return e[r]=n.$dirty}),$weakTouches:G(i,function(e,t){var r=t.path,n=t.$state;return e[r]=n.$touched}),$weakFocuses:G(i,function(e,t){var r=t.path,n=t.$state;return e[r]=n.$focused}),$weakPendings:G(i,function(e,t){var r=t.path,n=t.$state;return e[r]=n.$pending}),$getFirstError:function e(t){if(t){var r=d.$getField(t);return r&&r.$getFirstError()}for(var n in d.$weakErrors){var i=d.$weakErrors[n];for(var a in i){return i[a]instanceof Error?i[a].message:i[a]}}},$render:this.$render,$getField:this.$getField,$onValidates:this.$onValidates,$new:function e(){return t.$formutil},$setStates:this.$setStates,$setValues:this.$setValues,$setErrors:this.$setErrors,$setTouches:this.$setTouches,$setDirts:this.$setDirts,$setFocuses:this.$setFocuses,$batchState:this.$batchState,$batchTouched:this.$batchTouched,$batchDirty:this.$batchDirty,$batchFocused:this.$batchFocused,$reset:this.$reset,$validates:this.$validates,$validate:this.$validate,$valid:!o,$invalid:o,$dirty:l,$pristine:!l,$touched:$,$untouched:!$,$focused:f,$pending:c};return r.createElement(S.Provider,{value:this.getFormContext()},this._render())}}]);return n}(t.Component);ee.displayName="React.Formutil.Form";ee.defaultProps={$defaultValues:{},$defaultStates:{}};function te(e,t){if(e==null)return{};var r={};var n=Object.keys(e);var i,a;for(a=0;a<n.length;a++){i=n[a];if(t.indexOf(i)>=0)continue;r[i]=e[i]}return r}function re(e,t){if(e==null)return{};var r=te(e,t);var n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++){n=a[i];if(t.indexOf(n)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,n))continue;r[n]=e[n]}}return r}function ne(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var i=function(t){P(i,t);function i(){m(this,i);return C(this,F(i).apply(this,arguments))}y(i,[{key:"render",value:function t(){var i=Object.assign({},this.props);var a=this.props,u=a.component,o=re(a,["component"]);["$defaultStates","$defaultValues","$onFormChange","$validator","$processer"].forEach(function(e){if(e in i){if(e==="$defaultStates"||e==="$defaultValues"){o[e]=s({},n[e],i[e])}delete i[e]}});return r.createElement(ee,Object.assign({},n,o,{render:function t(n){return r.createElement(e,Object.assign({},i,{$formutil:n}))}}))}}]);return i}(t.Component);i.displayName="React.Formutil.withForm."+(e.displayName||e.name||"Anonymous");return a(i,e)}var ie=I(ne);var ae=0;var ue={$valid:true,$invalid:false,$dirty:false,$pristine:true,$touched:false,$untouched:true,$focused:false,$pending:false,$error:{}};function oe(e){return e!==true}function se(e,t,r){i(!x(e),"You should return a string or Error when the validation('".concat(r&&r+": ").concat(t,"') failed, otherwise return true."))}var le="React.Formutil.Field";function $e(){return ae++}function fe(e,r){var n=r.children,i=r.render,a=r.component;if(a){return t.createElement(a,{$fieldutil:e})}if(D(i)){return i(e)}if(D(n)){return n(e)}return t.Children.map(n,function(r){return r&&D(r.type)?t.cloneElement(r,{$fieldutil:e}):r})}function ce(e,t){var r={$$FIELD_UUID:e.$$FIELD_UUID,$$reset:o,$$merge:b,$$detectChange:i,$$triggerChange:a,$onValidate:u,$new:function t(){return e.$fieldutil},$picker:l,$getState:l,$getComponent:function e(){return t},$reset:function t(r,n){return e.$setState(o(r),n)},$getFirstError:y,$validate:$,$setState:e.$setState,$render:f,$setValue:c,$setTouched:d,$setDirty:v,$setFocused:p,$setValidity:m,$setError:h,$setPending:g};var n;function i(e){if("$value"in e||"$viewValue"in e){$()}}function a(t){var r=t.$newValue,n=t.$prevValue;var i=e.props.$onFieldChange;if(D(i)){i(r,n,e.$formContext.$formutil)}}function u(e){n.then(e);return n}function o(t){var r;var n=e.props,i=e.$formContext;if(i.$$getDefault){var a=n.name;var u=i.$$getDefault(),o=u.$$defaultStates,l=u.$$defaultValues;if(a&&l){var $=q(l,a);r=q(o,a)||{};if(!x($)){r.$value=$}}}var f=n.$defaultValue,c=n.$defaultState;return b(s({},ue,D(c)?c(n):c,{$value:D(f)?f(n):"$defaultValue"in n?f:""},r,t))}function l(){return s({},e.$state)}function $(t){return n=new Promise(function(r){var n=e.props,i=e.$formContext;var a=s({},n.$validators,n.$asyncValidators);var u=e.$state,o=u.$value,l=u.$pending,$=Object.assign({},u.$error);var f=i.$formutil;var c={};var d=false;var v;var p;var y;var b;delete $[W];var V=Object.keys(a).reduce(function(t,r){delete $[r];if(!d&&n[r]!=null){var i=a[r](o,n[r],s({},n,{$formutil:f,$fieldutil:e.$fieldutil,$validError:c}));if(_(i)){t.push(i.catch(function(e){if(!v){m(r,e||r)}}))}else if(oe(i)){c[r]=i||r;se(i,r,n.name);if(n.$validateLazy){d=true}}}return t},[]);var w=function e(n){return r(U(t,U(y,n)))};if(V.length){if(!l){g(true)}p=function e(t){return v=t(w)};V.push(h(s({},$,c)));b=Promise.all(V).then(function(){if(v){return v}e.$shouldCancelPrevAsyncValidate=null;return g(false,w)})}else{if(l){g(false)}b=h(s({},$,c),w)}if(e.$shouldCancelPrevAsyncValidate){e.$shouldCancelPrevAsyncValidate(function(e){y=e;return b})}e.$shouldCancelPrevAsyncValidate=p})}function f(t,r){return e.$setState({$viewValue:t,$dirty:true},r)}function c(t,r){return e.$setState({$value:t},r)}function d(t,r){return e.$setState({$touched:t},r)}function v(t,r){return e.$setState({$dirty:t},r)}function p(t,r){return e.$setState({$focused:t},r)}function h(t,r){return e.$setState({$error:t},r)}function m(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var n=arguments.length>2?arguments[2]:undefined;var i=Object.assign({},e.$state.$error);if(oe(r)){i[t]=r||t;se(r,t,e.props.name)}else{delete i[t]}return h(i,n)}function g(t,r){return e.$setState({$pending:t},r)}function y(){var t=e.$state.$error,r=t===void 0?{}:t;for(var n in r){return r[n]instanceof Error?r[n].message:r[n]}}function b(t){var r=Object.assign({},t);if("$error"in r){if(!r.$error){r.$error={}}r.$valid=Object.keys(r.$error).length===0}var n=e.props,i=n.$parser,a=n.$formatter;if("$viewValue"in r&&!("$value"in r)){var u=function e(t){return r.$viewValue=t};r.$value=i?i(r.$viewValue,u):r.$viewValue}else if("$value"in r&&!("$viewValue"in r)){var o=function e(t){return r.$value=t};r.$viewValue=a?a(r.$value,o):r.$value}if("$valid"in r){r.$invalid=!r.$valid}else if("$invalid"in r){r.$dirty=!r.$invalid}if("$dirty"in r){r.$pristine=!r.$dirty}else if("$pristine"in r){r.$dirty=!r.$pristine}if("$touched"in r){r.$untouched=!r.$touched}else if("$untouched"in r){r.$touched=!r.$untouched}e.$state=s({},e.$state,r);return l()}return r}var de=function(e){P(t,e);function t(){var e;var r;m(this,t);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++){i[a]=arguments[a]}r=C(this,(e=F(t)).call.apply(e,[this].concat(i)));r.$$FIELD_UUID=$e();r.$formContext=void 0;r.$state=void 0;r.$setState=function(e,t){return new Promise(function(n){var i=function e(){return n(U(t,r.$fieldutil))};if(r.isMounting){var a=r.props.name;if(a in(r.$formContext.$$registers||{})){r.$formContext.$$onChange(a,e,i)}else{r.$registered.$$merge(e);r.$registered.$$detectChange(e);r.forceUpdate(i)}}else{r.$registered.$$merge(e);i()}})};return r}y(t,[{key:"componentDidMount",value:function e(){this.isMounting=true;var t=this.props.name,r=this.$formContext;i(!t||r.$formutil,"You should enusre that the <Field /> with the name '".concat(t,"' must be used underneath a <Form /> component or withForm() HOC, otherwise it's isolated."));i(t,"You should assign a name to <Field />, otherwise it will be isolated!");if(r.$$register){r.$$register(t,this.$fieldHandler)}this.$prevValue=this.$state.$value}},{key:"componentWillUnmount",value:function e(){if(this.$formContext.$$unregister){this.$formContext.$$unregister(this.props.name,this.$fieldHandler,this.props.$reserveOnUnmount)}this.isMounting=false}},{key:"componentDidUpdate",value:function e(t){var r=this.props.name;if(r!==t.name){if(this.$formContext.$$register){this.$formContext.$$register(r,this.$fieldHandler,t.name)}}if(this.$state.$value!==this.$prevValue){if(!(r in(this.$formContext.$$registers||{}))){this.$registered.$$triggerChange({$newValue:this.$state.$value,$prevValue:this.$prevValue})}this.$prevValue=this.$state.$value}}},{key:"_render",value:function e(){var t=this.$fieldutil=s({$name:this.props.name},this.$registered.$getState(),this.$registered,{$$formutil:this.$formContext.$formutil});return fe(t,this.props)}},{key:"render",value:function e(){var t=this;var n=!this.$formContext;return r.createElement(S.Consumer,null,function(e){t.$formContext=e;if(!t.$fieldHandler){t.$fieldHandler=ce(t,t)}t.$registered=(e.$$registers||{})[t.$fieldHandler.$name]||t.$fieldHandler;if(n){t.$fieldHandler.$$reset();t.$fieldHandler.$validate()}return t._render()})}}]);return t}(t.Component);de.displayName=le;function ve(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var i=function(t){P(i,t);function i(){m(this,i);return C(this,F(i).apply(this,arguments))}y(i,[{key:"render",value:function t(){var i=Object.assign({},this.props);var a=this.props,u=a.component,o=re(a,["component"]);["$validators","$asyncValidators","$validateLazy","$reserveOnUnmount","$defaultValue","$defaultState","$onFieldChange","$parser","$formatter","name"].concat(Object.keys(s({},n.$validators,n.$asyncValidators,i.$validators,i.$asyncValidators))).forEach(function(e){if(e in i){if(e==="$validators"||e==="$asyncValidators"||e==="$defaultState"){o[e]=s({},n[e],i[e])}delete i[e]}});return r.createElement(de,Object.assign({},n,o,{render:function t(n){return r.createElement(e,Object.assign({},i,{$fieldutil:n}))}}))}}]);return i}(t.Component);i.displayName="React.Formutil.withField."+(e.displayName||e.name||"Anonymous");return a(i,e)}var pe=I(ve);var he=function(e){P(t,e);function t(){m(this,t);return C(this,F(t).apply(this,arguments))}y(t,[{key:"render",value:function e(){var t=this;var n=this.props,i=n.$fieldutil,a=n.value,u=n.onChange,o=n.onFocus,s=n.onBlur,l=n.checked,$=n.unchecked,f=re(n,["$fieldutil","value","onChange","onFocus","onBlur","checked","unchecked"]);var c=this.props.type;var d={value:"compositionValue"in this?this.compositionValue:a,onCompositionEnd:function e(r){t.composition=false;delete t.compositionValue;d.onChange(r)},onCompositionStart:function e(){return t.composition=true},onChange:function e(r){var n=r.target.value;if(t.composition){t.compositionValue=n;t.forceUpdate()}else{u(n,r)}},onFocus:o,onBlur:s};var v="input";switch(c){case"select":v=c;d.onChange=function(e){var t=e.target;var r=t.multiple?[].slice.call(t.options).filter(function(e){return e.selected}).map(function(e){return e.value}):t.value;u(r,e)};delete f.type;break;case"textarea":v=c;delete f.type;break;case"checkbox":case"radio":d={checked:a===l,onChange:function e(t){u(t.target.checked?l:$,t)},onFocus:o,onBlur:s};break;default:break}return r.createElement(v,Object.assign({},f,d))}}]);return t}(t.Component);he.displayName="React.Formutil.EasyField.Native";he.defaultProps={value:"",type:"text",checked:true,unchecked:false};var me=n({}),ge=me.Provider,ye=me.Consumer;var be=function(e){P(n,e);function n(){m(this,n);return C(this,F(n).apply(this,arguments))}y(n,[{key:"getGroupContext",value:function e(){return this.props}},{key:"_render",value:function e(){var n=this.props,i=n.className,a=n.groupNode,u=n.children;var o={GroupOption:Ve,Field:we};var s=D(u)?u(o):t.Children.map(u,function(e){return t.cloneElement(e,o)});if(a===null){return s}return r.createElement(a,{className:i},s)}},{key:"render",value:function e(){return r.createElement(ge,{value:this.getGroupContext()},this._render())}}]);return n}(t.Component);be.displayName="React.Formutil.EasyField.Group";be.defaultProps={type:"checkbox",groupNode:"div"};var Ve=function(e){P(t,e);function t(){m(this,t);return C(this,F(t).apply(this,arguments))}y(t,[{key:"componentDidMount",value:function e(){i("$value"in this.props,"You should pass a $value to <GroupOption />.")}},{key:"render",value:function e(){var t=this.props,n=t.$value,i=t.onChange,a=t.onFocus,u=t.onBlur,o=re(t,["$value","onChange","onFocus","onBlur"]);return r.createElement(ye,null,function(e){var t=e.type,s=e.name;var l=t==="radio"?{checked:e.value===n,onChange:function t(r){e.onChange(n,r);i&&i(r)}}:t==="checkbox"?{checked:e.value.indexOf(n)>-1,onChange:function t(r){e.onChange(r.target.checked?e.value.concat(n):e.value.filter(function(e){return e!==n}),r);i&&i(r)}}:{value:e.value,onChange:function t(r){e.onChange(r);i&&i(r)}};return r.createElement("input",Object.assign({name:s},o,l,{type:t,onFocus:function t(r){e.onFocus(r);a&&a(r)},onBlur:function t(r){e.onBlur(r);u&&u(r)}}))})}}]);return t}(t.Component);Ve.displayName="React.Formutil.EasyField.Group.Option";var we=function(e){P(t,e);function t(){m(this,t);return C(this,F(t).apply(this,arguments))}y(t,[{key:"componentDidMount",value:function e(){i(false,'The "Field" property in EasyField\'s children-props has been deprecated. Please use "GroupOption" instead.')}},{key:"render",value:function e(){return r.createElement(Ve,this.props)}}]);return t}(t.Component);we.displayName="React.Formutil.EasyField.Group.Option.Deprecated";var Ce=r.Frament||"div";var Fe=function(e){P(t,e);function t(e){var r;m(this,t);r=C(this,F(t).call(this,e));r.id=0;r.latestValue=r.props.value;r.$formutil=void 0;r.FieldValidators={required:function e(t){return t!==null}};r.$onFormChange=function(e){e.$onValidates(function(e){var t=e.$invalid,n=e.$params;if(t){if(r.props.value.length){r.props.onChange(r.latestValue=[])}}else if(!u(r.props.value,n.list)){r.props.onChange(r.latestValue=n.list)}})};r.swap=function(e,t,n){return r.$setState(function(r){var n=r.items;var i=[n[e],n[t]];n[t]=i[0];n[e]=i[1];return n},n)};r.insert=function(){var e,t,n;for(var i=arguments.length,a=new Array(i),u=0;u<i;u++){a[u]=arguments[u]}a.forEach(function(r){if(D(r)){n=r}else if(typeof r==="number"){e=r}else if(typeof r==="object"){t=r}});return r.$setState(function(n){var i=n.items;if(x(e)){i.push(r.getId(t))}else{i.splice(e,0,r.getId(t))}return{items:i}},n)};r.remove=function(){var e,t;for(var n=arguments.length,i=new Array(n),a=0;a<n;a++){i[a]=arguments[a]}i.forEach(function(r){if(D(r)){t=r}else if(typeof r==="number"){e=r}});return r.$setState(function(t){var n=t.items;if(x(e)){n.pop()}else{n.splice(e,1)}if(!n.length){n=[r.getId()]}return{items:n}},t)};r.$setState=function(e,t){return new Promise(function(n){return r.setState(e,function(){return r.$formutil.$onValidates(function(e){return n(U(t,e))})})})};r.state={items:e.value.length?e.value.map(function(){return r.getId()}):[r.getId()],formKey:0};return r}y(t,[{key:"componentDidUpdate",value:function e(t){var r=this;if(this.props.value!==this.latestValue){this.setState({items:this.props.value.length?this.props.value.map(function(){return r.getId()}):[this.getId()],formKey:this.state.formKey+1});this.latestValue=this.props.value}}},{key:"getId",value:function e(t){return{id:this.id++,values:t}}},{key:"render",value:function e(){var t=this;var n=this.props,i=n.children,a=n.onFocus,o=n.onBlur,l=n.value;if(!D(i)){return null}var $={$length:this.state.items.length,$insert:this.insert,$remove:this.remove,$swap:this.swap,$push:function e(r,n){return t.insert(r,n)},$pop:function e(r){return t.remove(r)},$shift:function e(r){return t.remove(0,r)},$unshift:function e(r,n){return t.insert(0,r,n)},onFocus:a,onBlur:o};return r.createElement(ee,{key:this.state.formKey,$defaultValues:{list:l},$onFormChange:this.$onFormChange,children:function e(n){t.$formutil=n;return r.createElement(Ce,null,t.state.items.map(function(e,a){var o=e.id,l=e.values;return r.createElement(de,{key:o,required:true,$defaultValue:l||null,$validators:t.FieldValidators,name:"list[".concat(a,"]"),children:function e(o){return r.createElement(ee,{$defaultValues:o.$value||{},$onFormChange:function e(t){return t.$onValidates(function(e){var t=e.$invalid,r=e.$params;if(t){if(o.$viewValue!==null){o.$render(null)}}else if(!u(o.$viewValue,r)){o.$render(r)}})},children:function e(r){return i(s({},$,r,{$index:a,$isLast:function e(){return a===t.state.items.length-1},$isFirst:function e(){return a===0}}),n)}})}})}))}})}}]);return t}(t.Component);Fe.displayName="React.Formutil.EasyField.List";var ke="__TYPE__";var Pe=[["required",function(e,t,r){var n=r.__TYPE__,i=r.checked,a=i===void 0?true:i;return n==="checked"?e===a:!N(e)}],["maxLength",function(e,t){return N(e)||e.length<=t}],["minLength",function(e,t){return N(e)||e.length>=t}],["max",function(e,t){return N(e)||e*1<=t}],["min",function(e,t){return N(e)||e*1>=t}],["pattern",function(e,t){return N(e)||t.test(e)}],["enum",function(e,t){return N(e)||t.indexOf(e)>-1}],["checker",function(e,t,r){return t(e,r)}]].reduce(function(e,t){var r=h(t,2),n=r[0],i=r[1];e[n]=function e(t,r,a){var u=a.validMessage,o=u===void 0?{}:u;return i.apply(void 0,arguments)||o[n]||"Error input: ".concat(n)};return e},{});var Se="React.Formutil.EasyField";var Ee={validMessage:{},valuePropName:"value",changePropName:"onChange",focusPropName:"onFocus",blurPropName:"onBlur",$parser:function e(t){return typeof t==="string"?t.trim():t}};function Oe(e,t,r){var n;var i=t.valuePropName,a=t.changePropName,u=t.focusPropName,l=t.blurPropName,$=t.passUtil;var f=function e(t){return t&&t.target?t.target[i]:t};var d=s({},r,(n={},o(n,i,e.$viewValue),o(n,a,function(){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++){n[i]=arguments[i]}var u=n[0];var o=n[n.length-1];if(!o||!o.target){o=n}else{o=[o]}var s=t[a];s&&s.apply(void 0,c(o));var l=f(u);e.$render(l)}),o(n,u,function(){var r=t[u];r&&r.apply(void 0,arguments);e.$setFocused(true)}),o(n,l,function(){var r=t[l];r&&r.apply(void 0,arguments);if(e.$untouched){e.$setTouched(true)}e.$setFocused(false)}),n));if($){d[$===true?"$fieldutil":$]=e}return d}function je(e){var t=e.children,r=e.component,n=e.render,i=re(e,["children","component","render"]);var a=i.name,u=i.type,o=i.defaultValue,l=i.valuePropName,$=i.changePropName,f=i.focusPropName,c=i.blurPropName,d=i.validMessage,v=i.__TYPE__,p=i.passUtil,m=i.$defaultValue,g=i.$defaultState,y=i.$onFieldChange,b=i.$validators,V=i.$asyncValidators,w=i.$validateLazy,C=i.$reserveOnUnmount,F=i.$parser,k=i.$formatter,P=re(i,["name","type","defaultValue","valuePropName","changePropName","focusPropName","blurPropName","validMessage","__TYPE__","passUtil","$defaultValue","$defaultState","$onFieldChange","$validators","$asyncValidators","$validateLazy","$reserveOnUnmount","$parser","$formatter"]);var S={children:t,component:r,render:n};var E=!x(u)||x(t)&&x(r)&&x(n);Object.keys(s({},i.$validators=s({},Pe,i.$validators),i.$asyncValidators)).forEach(function(e){if(e in P){if(!E||!M(e)){delete P[e]}}});if(E){var O=(u||"").split("."),j=h(O,2),D=j[0],N=D===void 0?"text":D,_=j[1];S.component=N==="group"?be:N==="list"?Fe:he;if(a){P.name=a}if(u){P.type=N}if(t){P.children=t}switch(N){case"select":case"textarea":if(e.multiple){i[ke]="array"}break;case"group":if(_==="checkbox"){i[ke]="array"}P.type=_;break;case"checkbox":case"radio":i[ke]="checked";break;case"list":i[ke]="array";break;default:break}}if(!("$defaultValue"in i)&&"defaultValue"in e){i.$defaultValue=o}if(!("$defaultValue"in i)&&ke in i){var A;switch(i[ke]){case"checked":var T=i.unchecked,R=T===void 0?false:T;A=R;break;case"array":A=[];break;case"object":A={};break;case"number":A=0;break;case"empty":default:break}i.$defaultValue=A}return{fieldProps:i,childProps:P,renderProps:S}}function xe(e,r){var n=r.component,i=r.render,a=r.children;if(n){return t.createElement(n,e)}if(D(i)){return i(e)}if(D(a)){return a(e)}return t.Children.map(a,function(r){return t.cloneElement(r,e)})}var De=function(e){P(t,e);function t(){m(this,t);return C(this,F(t).apply(this,arguments))}y(t,[{key:"render",value:function e(){var t=je(this.props),n=t.fieldProps,i=t.childProps,a=t.renderProps;return r.createElement(de,Object.assign({},n,{children:function e(t){return xe(Oe(t,n,i),a)}}))}}]);return t}(t.Component);De.displayName=Se;De.defaultProps=Ee;function Ne(e){var n=function(t){P(n,t);function n(){m(this,n);return C(this,F(n).apply(this,arguments))}y(n,[{key:"render",value:function t(){var n=this;return r.createElement(S.Consumer,null,function(t){return r.createElement(e,Object.assign({},n.props,{$formutil:t.$formutil}))})}}]);return n}(t.Component);n.displayName="React.Formutil.connect."+(e.displayName||e.name||"Anonymous");return a(n,e)}function _e(){if(!r.useState){throw new Error("Hooks api need react@>=16.8, Please upgrade your reactjs.")}var e=r.useContext;var t=e(S);return t}function Ae(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!r.useState){throw new Error("Hooks api need react@>=16.8, Please upgrade your reactjs.")}var n=r.useState,a=r.useLayoutEffect,u=r.useRef;var o;if(e){if(typeof e==="string"){o=e;t.name=o}else{t=e;o=t.name}}var l=_e();var $=u({}).current;var f=u([]);var d;$.$formContext=l;$.props=t;$.$setState=g;var v=n(function(){$.$$FIELD_UUID=$e();$.$fieldHandler=d=ce($);var e=$.$fieldHandler.$$reset();$.$fieldHandler.$validate();return e}),p=h(v,2),m=p[1];if(!d){d=(l.$$registers||{})[$.$fieldHandler.$name]||$.$fieldHandler}a(function(){var e=$.$state;if($.isMounting){if(!(o in(l.$$registers||{}))){var t=$.$prevValue;d.$$triggerChange({$newValue:e.$value,$prevValue:t})}}$.$prevValue=e.$value},[$.$state.$value]);a(function(){$.isMounting=true;i(!o||l.$formutil,"You should enusre that the useField() with the name '".concat(o,"' must be used underneath a <Form /> component or withForm() HOC, otherwise it's isolated."));i(o,"You should pass a name argument to useField(), otherwise it will be isolated!");return function(){if(l.$$unregister){l.$$unregister(o,$.$fieldHandler,t.$reserveOnUnmount)}$.isMounting=false}},[]);a(function(){if(l.$$register){l.$$register(o,$.$fieldHandler,$.$prevName)}$.$prevName=o},[o]);a(function(){if(f.current.length>0){var e=c(f.current);f.current.length=0;while(e.length){e.pop()($.$fieldutil)}}});function g(e,t){return new Promise(function(r){var n=function e(){return r(U(t,$.$fieldutil))};if($.isMounting){if(o in(l.$$registers||{})){l.$$onChange(o,e,n)}else{m(d.$$merge(e));d.$$detectChange(e);f.current.push(n)}}else{d.$$merge(e);n()}})}return $.$fieldutil=s({$name:o},d.$getState(),d,{$$formutil:l.$formutil})}function Te(){var e=_e(),t=e.$formutil;return t}function Re(e){e=s({},Ee,e,{children:null});var t=je(e),r=t.fieldProps,n=t.childProps;var i=Ae(r);return Oe(i,r,n)}exports.EasyField=De;exports.Field=de;exports.Form=ee;exports.connect=Ne;exports.useField=Ae;exports.useForm=Te;exports.useHandler=Re;exports.withField=pe;exports.withForm=ie;
